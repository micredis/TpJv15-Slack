Grigory Kislin [12:17 AM]
joined #hw3.

Grigory Kislin [12:17 AM]
set the channel topic: https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson03.md

Grigory Kislin [12:18 AM]
Добро пожаловать не 3й урок: https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson03.md
JUnit тестирование и начало работы с DB
Если с SQL и RDBMS опыта нет, прочти основы по ссылкам занятия (edited)

Gekov Iliya [12:20 AM]
joined #hw3 along with 18 others.


koderman [Oct 18th at 1:31 PM]
Вопрос, чет не то с патчами у меня, почему так может быть, красным выделен файл, получается в каком то патче не загрузились изменения?


7 replies
Ansseii [4 days ago]
У меня все патчи встали без проблем. Проверь последовательность по уроку, может забыл 2 верхних сначала накатить. И проверь, что льешь в master


koderman [4 days ago]
А если патчи которые уже загрузил второй раз грузить не будет конфликтов?


Ansseii [4 days ago]
Лучше откатись к началу


koderman [4 days ago]
ок, попробую спасибо


fibz [4 days ago]
@koderman там в предыдущем патче MealTo уже было в to, и в этом патче оно опять пишется а to, просто надо снять галоку с MealTo. Я так делал (edited)


Vladimir Gorbatenko [4 days ago]
Есть засада с директорией "test", которую нужно своевременно создать, перед "Apply_07_add_junit.patch"


koderman [4 days ago]
понял, починил, норм, учеба продолжается)


koderman Oct 18th at 1:31 PM

gleb 4 days ago
Откройте в идее вкладку version control на ней выберете ветку master и посмотрите, все ли комиты из второго урока вы применили

koderman 4 days ago
все получилось)

gleb 3 days ago
гуд)


Dmitriy Oct 18th at 2:25 PM
Как работает filter в методе getAllFiltered класса InMemoryMealRepositoryImpl? Predicate<Meal> filter = meal -> true.
В getAllFiltered получили мапу по ID пользователя в которой еда текущего пользователя, после применения .filter(filter) что поменяется?

Dmitriy 4 days ago

Dima 4 days ago
В данном случае ниче не поменяется,фильтр проходят те записи стрима которыеудовлетворяют условию. если true,то все удовлетворяют условию



Igor [Oct 18th at 5:10 PM]
Какую версию PostgreSQL ставить?


3 replies
Sergey Zhukov [4 days ago]
11ю ставь, как раз сегодня вышла :grin:


Sergey Zhukov [4 days ago]
с 11 у меня что-то не срослось, хотел поставить рядом с 10й версией, в другую папку и на другом порту
postgres11_warning.jpg



Grigory Kislin [4 days ago]
у меня 10


Igor [Oct 18th at 5:12 PM]
С MS SQL проекты на java бывают?


8 replies
Yevhen Maksymovych [4 days ago]
с любым бывают, с точки зрения джавы, ей вообще по барабану, какая машина там базу обслуживает, главное, чтобы под нее был драйвер, соответствующий спецификации jdbc


Yevhen Maksymovych [4 days ago]
под mssql вот есть


Igor [4 days ago]
В возможностях java нет сомнений. Меня интересует с какими субд чаще всего сталкиваются java разработчики.


Andrey Tolkachev [4 days ago]
думаю MySQL одна из самых популярных, хотя в настоящее время может уже и не так


shomnest [4 days ago]
Как правило Postgre на более или менее серьезных проектах, а в целом тенденция в сторону nosql


shomnest [4 days ago]
Крупные конторы, мировые, оракл пользуют и DB2 от ibm (edited)


shomnest [4 days ago]
А по поводу mssql, лично у меня сложилось мнение что используют его в конторах, где 1с, ну или шарп на крайняк)


Grigory Kislin [4 days ago]
статистика за 2016г:
https://zeroturnaround.com/rebellabs/java-tools-and-technologies-landscape-2016/
https://zeroturnaround.com/rebellabs/java-tools-and-technologies-landscape-2016-pivoting-data/
чем курпнее и бюракратичнее контора, тем больше Oracle (за них были хорошие откаты в виде всяких конференций в штаты)
Лично я постоянно с PostgreSQL стлкивался, ни разу с MySQL. Вообще тенденция на него мигрировать, MySQL имо- больше для php/python. NoSQL это вещь для специфических нужно, чаще всего как дополнение к SQL DB
zeroturnaround.com
Java Tools and Technologies Landscape Report 2016 |
This report analyzes the data about the tools and technologies Java developers use: IDEs, build, tools, servers, frameworks, databases, and so on. (224 kB)
 zeroturnaround.com
Java Tools and Technologies Landscape Report 2016: Pivoting data |
This report analyzes the data about the tools and technologies Java developers use: IDEs, build, tools, servers, frameworks, databases, and so on. (224 kB)
(edited)


fibz [Oct 18th at 5:28 PM]
@Grigory Kislin, мы будем использовать Мокито в тестах? (edited)


2 replies
Yevhen Maksymovych [4 days ago]
в предыдущих итерациях топджавы не использовали


Grigory Kislin [4 days ago]
не будем. скорее всего будет в spring-boot проекте, который готовится


lifter4ik [Oct 18th at 7:52 PM]
у меня вопрос про логирование: к третьему занятию логгер остался только в контроллере. это его дефолтное место или на разных проектах по разному?


2 replies
Varguss [4 days ago]
Количество логирования ограничено извращенностью программиста :slightly_smiling_face: Контроллеры и сервисы обычно логируются, как я знаю. Если сервисного уровня нет, то вместо него логируется дао. А можно и сервисный, и дао уровень залогировать.


Grigory Kislin [4 days ago]
тут я затрудняюсь с тем, где обычно... скорее - везде, где хочется (edited)


Илья Чиликин [Oct 18th at 10:34 PM]
После патчей пакет repository.mock пустой. Так и должно быть? Причём InMemoryAdminRestControllerSpringTest  пытается вайрить InMemoryUserRepositoryImpl, которого нет. (edited)


7 replies
Gekov Iliya [4 days ago]
Все патчи еще не накатил, но судя по письму Григория сверить можно на гитхабе текущую версию https://github.com/JavaWebinar/topjava (edited)


Dima [4 days ago]
почему нет, нажми на значок зависимости и посмотри сверху путь, что спринг пытается прикрутить. Он все берет из папки тест
222.jpg



Gekov Iliya [4 days ago]
@Dima Вы все патчи накатили? Судя по ссылке выше на актуальную версию, этих классов действительно нет


Dima [4 days ago]
@Gekov Iliya пока что не все. Ну посмотрим че дальше будет.


Gekov Iliya [4 days ago]
А, это тест, невнимательно посмотрел, тогда все на месте, и репозиторий и контроллер, но все это в папке test


Grigory Kislin [4 days ago]
пустые пакеты можно удалять. git не умеет с каталагами работать- только с файлами



Илья Чиликин [3 days ago]
Окей, дальше всё стало понятно. Меня смутило наличие пустой папки после применения патчей.


oleg_sv [Oct 18th at 10:57 PM]
Осторожно! Возможны проблемы с PostgreSQL 11. У меня, при подключении к Idea на любое действие выбрасывался exception:
"[42703] org.postgresql.util.PSQLException: ОШИБКА: столбец "proisagg" не существует". В гугле пишут, что это проблема именно 11-ой версии. Заменил на 10.5, пока что работает стабильно.


1 reply
Sergey Zhukov [4 days ago]
у меня сервер 11 не стартует, оставил тоже 10


Andrew Kalugin [Oct 19th at 10:49 AM]
не устанавливается postgresql. может кто подскажет в чем дело?
error.jpg



22 replies
Ansseii [3 days ago]
Советую первым делом спрашивать Гугл. Первая же ссылка предлагает решение:
https://www.postgresql.org/message-id/1351573815927-5730009.post@n5.nabble.com


Andrew Kalugin [3 days ago]
Я уже много что перепробовал. По этой ссылке уже ходил - не помогает!


Ansseii [3 days ago]
У вас Win10?
Если да, то идем в
HKEY_CURRENT_USER\Software\Microsoft\Windows Script Host\Settings
и выставляем Value Data в 1 (edited)


Andrew Kalugin [3 days ago]
нет у меня win7 x64. Но этот метод тоже знаю и пробовал - не помогло


Andrew Kalugin [3 days ago]
В логаг пишет: Error running cscript //NoLogo "C:\Users\Андрей\AppData\Local\Temp\postgresql_installer_76b673c362\prerun_checks.vbs": Program ended with an error exit code


Ansseii [3 days ago]
Ну да, проблемы с запуском .vbs
https://dba.stackexchange.com/questions/50273/error-unable-to-write-inside-temp-environment-variable-path/54070
Внизу комментарии со ссылками с решением проблемы через реестр. У меня самого возможности потестить нет, так что пробуйте)
Database Administrators Stack Exchange
Error: Unable to write inside TEMP environment variable path
I am installing PostgreSQL 9.2.4-1-windows.exe on Windows 7 64 with Service Pack 1. I get the following, rather famous it seems, error: There has been an error. Unable to write inside TEMP
 


Sergey Zhukov [3 days ago]
@Andrew Kalugin 32-битную версию пробовал ставить? (edited)


Andrew Kalugin [3 days ago]
32 не пробовал


Sergey Zhukov [3 days ago]
у меня ставилась но криво, тоже win764, а 32-битная взлетела нормально


Sergey Zhukov [3 days ago]
качал то отсюда? https://www.enterprisedb.com/downloads/postgres-postgresql-downloads
enterprisedb.com
PostgreSQL Download
PostgreSQL is the world’s most advanced open source database and the fourth most popular database. In development for more than 20 years, PostgreSQL is managed by a well-organized and highly principled and experienced open source community. It is an object-oriented database that is fully ACID compliant and highly extensible, enabling the community to add new features and capabilities as workload demands evolved.


Andrew Kalugin [3 days ago]
@Ansseii по ссылке выше тоже ходил :disappointed: у меня там в реестре все норм и менять нечего. попробую nootpade++ совсем убить (edited)

Andrew Kalugin [3 days ago]
да качал по офф ссылке

Andrew Kalugin [3 days ago]
попробую 32 установить

Sergey Zhukov [3 days ago]
и пути не меняй ставь по-умолчанию, запускай правой кнопкой - от администратора (edited)

Ansseii [3 days ago]
На крайний случай всегда есть архив


Andrew Kalugin [3 days ago]
Бесполезно. Ни работает ни как :disappointed:


Sergey Zhukov [3 days ago]
ставь 10 (edited)


Sergey Zhukov [3 days ago]
обновления на винду приходят? какая редакция sp1 или без него


Sergey Zhukov [3 days ago]
антивир еще приглуши если это каспер

Dima [3 days ago]
Я поставил версию postgre10.5 на винду 10. 11 версия не установилась,упала с ошибкой в самом начале


Andrew Kalugin [3 days ago]
Уффф..... не хорошая хреновина по имени McAfee (которую я уже давно удалил) заменила собой обработчик VBS. Хитро замаскировалась в реестре (несколько раз ее не заметил) , да еще прост так удаляться не хотела. Пришлось похимичить с реестром и все заработало!!! :grinning:



Andrew Kalugin [3 days ago]
вдруг кому пригодится https://kc.mcafee.com/corporate/index?page=content&id=KB86138
kc.mcafee.com
Applications that require VBScripts fail to load and Windows Script Host errors are reported after uninstalling VirusScan Enterprise or migrating to Endpoint Security
ScriptScan might leave the following registry key behind after VSE removal or migration: HKEY_CLASSES_ROOT\CLSID\{B54F3741-5B07-11cf-A4B0-00AA004A55E8}\InprocServer C:\Program Files\Common Files\McAfee\SystemCore\ScriptSn.nnnnnnnnnnn.dll. E Failed to set HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\{B54F3741-5B07-11cf-A4B0-00AA004A55E8}\InprocServer32 to C:\windows\system32\vbscript.dll S C:\windows\system32\vbscript.dll was register. Before proceeding, Technical Support strongly recommends that you Show more…


Marat [Oct 19th at 12:19 PM]
В чем вопрос этого вопроса: Вопрос: почему проект упадет при попытке открыть страничку еды (в логе смотреть самый верх самого нижнего исключения)?
Исправить ошибку?
Или она исправится накатом следующего патча?


5 replies
Taras [3 days ago]
Не исправляй, патчи должны друг за другом идти.


Dima [3 days ago]
Надо просто ответить на вопрос,почему упадет. Посмотреть exception,понять из-за чего упало



indisbk [3 days ago]
Так ответ в том, что spring не может найти имплементацию интерфейса?(из-за переноса класса в test)


ABaykov [3 days ago]
Bingo ) он же тебе так и пишет, что нужна как минимум одна имплементация)


indisbk [3 days ago]
так я думал подвох какой есть))


Sergey Zhukov [Oct 19th at 3:24 PM]
вы видосы по спрингу смотрели? смотрю и ржу :rolling_on_the_floor_laughing:


17 replies
lifter4ik [3 days ago]
от Борисова которые?


Dima [3 days ago]
Потрошителя я смотрел уже много раз.Он обьясняет лучше чем в книге и дает дельные советы,особенно по @PostConstract


Sergey Zhukov [3 days ago]
ага борисова


Sergey Zhukov [3 days ago]
Java-StandUp


Dima [3 days ago]
Еще более интересный видос от него же boot-потрошитель


Стецко Максим [3 days ago]
вечерком собирался их посмотреть, много полезного молвит?


Dima [3 days ago]
Если не знаком с рефлекш ,заодно и его подтянешь)


Dmitriy [3 days ago]
Один из лучших лекторов)


Sergey Zhukov [3 days ago]
@Dima ты это видео про @PostConstract смотрел?
https://www.youtube.com/watch?v=nGfeSo52_8A
YouTube JUG .ru
Евгений Борисов — Spring – Глубоко и не очень
 


Taras [3 days ago]
Посмотрите ещё его же spring puzzlers (оба сезона) и Приключение Сеньора Холмса и Джуниора Ватсона. И наржётесь, и много полезного (не за один раз) узнаете.. :)


Dima [3 days ago]
@Sergey Zhukov ну может, я уже не помню) Помню только, что по мотивам я сделал свой джарник с аннотацией, чтоб не пользоваться постконстракт, а внедрять свою)


Sergey Zhukov [3 days ago]
я к тому, что от версии к версии Спринг меняется, он сам говорит что его предыдущие  решения могут не работать на новой версии, и приводит в пример терминатора (edited)


Dima [3 days ago]
они работают, наоборот, можно допустим не прописывать в javaconfig свои бинпостпроцессоры, они уже сами автоматом добавляются в контекст при подключении джарника.


Sergey Zhukov [3 days ago]
ага, сам уже умеет


Dima [3 days ago]
а вот ту проблему с постконстракт и java конфигурацией возможно еще не пофиксили, так что можно свою аннотацию толкать.


Dima [3 days ago]
А интересно, на собеседовании могут спросить, чем отличается BeanPostProcessor от BeanFactoryPostProcessor? (edited)


Ilya [1 day ago]
Спасибо за наводку) интересные видосы


Artem [Oct 19th at 4:27 PM]
та же ерунда, что и в сообщении выше: после патча 3_08_add_spring_test мавен сошел с ума и отказался подтягивать спринг-тест. очистка .m2/repository помогла, теперь в pom спринг-тест подтягивается нормально, но в окне мавена в депенденси все равно подчеркивается красным. сборке проекта это в данный момент не мешает. это на что-нибудь повлияет в дальнейшем? или не напрягаться и накатывать патчи дальше?
Ikke navngitt.jpg



4 replies
Стецко Максим [3 days ago]
никак) идею перезапусти и все ок будет)



Artem [3 days ago]
:neutral_face:
Pasted image at 2018-10-19, 3:32 PM



Sergey Zhukov [3 days ago]
У меня тоже maven не смог подтянуть зависимость.
Я зашел в папку #C:\Users\{Имя пользователя}\.m2\repository\org\springframework\spring-test# и обнаружил там много версий от предыдущих импортов. Удалил все эти версии и сделал Maven->Reimport.
Все заработало.


Raisa [1 day ago]
у меня такая же проблема с патчем 3_08, но перезапуск идеи не помог, в папке spring-test всего одна версия, clean+reimport тоже не помогли


Стецко Максим [Oct 19th at 4:29 PM]
на WIN 10 64 у кого нибудь проблема с установкой postgresql 10.5 была??? И 32, и 64 при запуске pgAdmin выдает ошибку An error occured initialising the application server. Failed to launch the application server, server thread exiting."


6 replies
Стецко Максим [3 days ago]
если ставить 9.6 то она пойдет?


Sergey Zhukov [3 days ago]
наверно любая пойдет


Стецко Максим [3 days ago]
блин и она такую же ошибку выдает(


indisbk [3 days ago]
попробуй BigSql, может пойдет.


Стецко Максим [3 days ago]
В общем решил проблему, оказалось что папка пользователя не может иметь русских букв (C:\Users\). Через новую учетку админа переименовал свои папки. Все сразу запустилось...


Gekov Iliya [11 hours ago]
@Стецко Максим Спасибо за решение, возникла аналогичная проблема из-за кириллицы в папке Users, кто-бы мог подумать, что из-за такой мелочи могут такие проблемы возникать...


Nikita Ganin [Oct 20th at 2:04 PM]
"3.4. Cписок еды должен быть отсортирован (тогда мы его сможем сравнивать с тестовыми данными)" Сортировку нужно сделать в jdbcRepository? (edited)


1 reply
Nikita Ganin [1 day ago]
Можно сделать сортировку через запрос sql


Zhinko [Oct 20th at 3:30 PM]
Кто-нибудь понял почему упало? 1 Понять, почему перестали работать SpringMain, InMemoryAdminRestControllerTest, InMemoryAdminRestControllerSpringTest


10 replies
Dmitriy [1 day ago]
Посмотри на строку, на которую ругается и на скрин из материалов к домашке SetSpringCtx.png (edited)


Zhinko [1 day ago]
посмотрел. Пока все-равно не понял


Dmitriy [1 day ago]
Пришли пожалуйста скрин или лог ошибки, так как там несколько проблем может быть с запуском


Zhinko [1 day ago]
Exception in thread "main" org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcUserRepositoryImpl' defined in file [C:\Users\User\Desktop\topJavaProject\topjava\target\classes\ru\javawebinar\topjava\repository\jdbc\JdbcUserRepositoryImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'org.springframework.jdbc.core.JdbcTemplate' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
    at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:767)
    at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:218)
    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1307)
    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1153)
    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:538)
    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
    at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
    at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
    at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
    at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
    at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:848)
    at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:865)
    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:548)
    at org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:144)
    at org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:85)
    at ru.javawebinar.topjava.SpringMain.main(SpringMain.java:20)
Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'org.springframework.jdbc.core.JdbcTemplate' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
    at org.springframework.beans.factory.support.DefaultListableBeanFactory.raiseNoMatchingBeanFound(DefaultListableBeanFactory.java:1648)
    at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1207)
    at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1168)
    at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:855)
    at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:758)
    ... 15 more

Process finished with exit code 1


Zhinko [1 day ago]
да точно спасибо!


Nikita Ganin [1 day ago]
Как я понял, spring не видит в конфигурации inmemoryuserrepository


Stepan [1 day ago]
нужно только понять? или еще исправить?

Nikita Ganin [1 day ago]
В optional надо исправить

under4eg [13 hours ago]
что по итогу нужно? нужно, чтобы спринг-мейн работал с реализацией в памяти, а милсервлет - с реализацией в бд? а то "починить" как-то слишком абстрактно звучит - можно починить костыльно так, что логика попросту работать не будет (edited)


Nikita Ganin [3 hours ago]
Для тестирования нужно, чтобы работал с реализацией в памяти.


Nikita Ganin [Oct 20th at 6:01 PM]
Кто-нибудь сделал 7-ой пункт? индексы должны добавляться при создании базы?


2 replies
Dmitriy [1 day ago]
CREATE UNIQUE INDEX по аналогии с users


Nikita Ganin [1 day ago]
Спасибо, я и не заметил, что там есть


Zhinko [3:49 PM]
подскажите по этому пункту. Как починить ?


Zhinko [Yesterday at 3:49 PM]
6 Почнинить SpringMain, InMemory*Test. InMemory*Test должны использовать реализацию в памяти


10 replies
Taras [20 hours ago]
Почитай внимательно что пишут логи, вспомни, как spring узнаёт, какие классы надо создавать, а какие он просто не видит (даже при наличии спринговой аннотации)….


Zhinko [20 hours ago]
я так понимаю, что spring не видит класс потому что InMemoryMealRepositoryImpl и InMemoryUserRepositoryImpl ушли в тесты?


Taras [20 hours ago]
Не совсем. В classpath попадают все классы из main и test. Посмотри, откуда spring знает, какие пакеты сканировать, чтобы прочитать аннотации..


Zhinko [19 hours ago]
короче я так и не сделал.


Zhinko [19 hours ago]
Добавил в тесты конфигурационный файл spring, но все равно не хочет нормально работать


Taras [18 hours ago]
Посмотри, какие пакеты указаны для сканирования в конфиг-файле, и в каких лежат имплементации репозиториев.


Zhinko [17 hours ago]
у меня сейчас выскакивает Caused by: org.springframework.beans.factory.NoUniqueBeanDefinitionException


Zhinko [17 hours ago]
то есть оно не знает какой бин создавать


Taras [17 hours ago]
Spring видит 2 имплементации интерфейса. А должна быть одна. Сузь пакет для сканирования.


Zhinko [16 hours ago]
Все разобрался спасибо


Alexey_b [Yesterday at 4:42 PM]
А кто-нибудь понял зачем нужна махинация с созданием нового локального change list и помещением туда database.properties ? (edited)


4 replies
pal548 [20 hours ago]
что за чендж лист?


Alexey_b [20 hours ago]
В самом конце видео 3_07 про настройку идеи с БД


pal548 [20 hours ago]
да, тоже не понял, почему например не добавить этот файл в .gitignore


Marat [18 hours ago]
Наверное для того чтобы изменения хранились локально на компьютере, но не заливались в гитхаб. А если добавить в .gitignore, то нельзя будет вернуть изменения


Zhinko [Yesterday at 6:19 PM]
кто 6 пункт дз сделал? (edited)


1 reply
Dima [17 hours ago]
Посмотри в SpringMain откуда ты берешь фаил для контекста и какие папки в нем сканируются на предмет добавления в контейнер бинов


KaryNaiKo [Yesterday at 9:34 PM]
При накатке 12 патча (логирование тестов). Откуда появляется столько инфы в консоле?


3 replies
Alexey_b [15 hours ago]
в файле logback-test.xml который в test/resources специально конфигурится вывод в консоль


KaryNaiKo [15 hours ago]
@Alexey_b Это понятно. Почему так много записей в консоле, откуда они?


Alexey_b [14 hours ago]
мне сейчас сложно с этим поэкспериментировать, так как все остальное не работает, но  level="INFO" и DEBUG включают в себя все остальные уровни и запиывают каждый чих. Можно сделать только ERROR


KaryNaiKo [Yesterday at 10:01 PM]
Почему логгер в папке test берет настройки из test.recource, а не из main.recource?
Почему в при запуске тестов, спринг поднимается с настройками, которые лежат в main.recource, а не из test.recource?
Ну то есть в чем разница ресурсов в main, test. И какая у них область видимости? (edited)


4 replies
Taras [14 hours ago]
Всё это объединяется и попадает в classpath при запуске тестов. Файлы из test/ перезаписывают аналогичные из main/.


KaryNaiKo [14 hours ago]
@Taras можно ссылку на источник?)


Taras [14 hours ago]
```http://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html```


Taras [14 hours ago]
Ну и остальное там же. Попробуй “поиграться“, всё станет понятно. :slightly_smiling_face:


Taras [Yesterday at 10:20 PM]
Вопрос по _5.1 Сделать тестовые данные MealTestData (точно такие же, как вставляем в populateDB.sql)_: что конкретно нужно сделать? Наполнить базу вручную данными из `MealTestData` (а взять из из `MealsUtil`) c помощью `MealService#create` или с помощью аннотации `@Sql` из файлы с sql? Зачем нам этот `MealTestData`? (edited)


5 replies
Roman Baranov [13 hours ago]
в `MealTestData` будут ожидаемые значения. в тесте будешь получать рез-ты операций которые тянут данные из базы. полученное значение сравнивается с ожидаемым.


Taras [12 hours ago]
Наверное, надо и базу наполнить тестовыми данными, и в этом классе их руками прописать. Тогда это будет иметь смысл. Хотя я бы разнёс тесты для репозитория и сервиса, а то у нас интеграционный тест получился.


Nikita Ganin [3 hours ago]
Наполнить базу надо было еще во 2 пункте.


Dima [3 hours ago]
значение тестов, как я понял, заключается в том, чтобы сравнить полученные данные с теми, что хардкорно записаны. База заполняется сама по себе перед каждым тестом, как вы правильно указали, с помощью @Sql. А вот в MealTestData вы должны сделать основную логику тестов. По типу проверок юзеров.


Taras [2 hours ago]
@Nikita Ganin Дело не в том, чтобы наполнить базу, а в тестовом наборе, с которым сравнивать базу. И ещё не забыть, что база должна возвращаться к исходному состоянию перед каждым тестом (для этого и `@Sql`). НО — есть потенциальная возможность изменить sql и не поменять данные в `MealTestData`, что меня и смутило… В общем, я уже всё сделал. Хотя в HW2 я «для себя» сделал тесты отдельно на репозиторий и отдельно на сервис с использованием `@RunWith(MockitoJUnitRunner.class)`, `@Mock` над репозиторием с последующей настройкой возвращаемых значений. ИМХО, так было бы правильнее тестировать…


fibz Today at 9:50 AM
при решении первого задания,  у меня вышло что в конструкторах сервиса я пишу квалифаер на реализацию репозитория таким образом.
При этом я поставил base-package="ru.javawebinar.**.repository", убрав jdbc
Насколько это правильно?
Можно ли Qualifier`ы вынести в spring-app.xml (edited)
@Autowired
public UserServiceImpl(@Qualifier("inMemoryUserRepositoryImpl") UserRepository repository) {
	this.repository = repository;
} 

Nikita Ganin 3 hours ago
Я сделал spring-app только для тестов где выбирается реализация репозитория из памяти.


Grigory Kislin [Yesterday at 12:45 PM]
inmemory классы находятся в test каталоге.
те они не попадают в приложение и оптимально приложение ничего не должено знать о них


1 reply
fibz [1 day ago]
Уже разобрался, спасибо


KaryNaiKo [7:13 PM]
Правильно ли я понимаю, что при выполнении тестов у нас спринг поднимается 3 раза?


This message was deleted.


4 replies
Gekov Iliya [19 hours ago]
"в JdbcUserRepositoryImpl.getByEmail() заменил queryForObject() на query(). Загляните в код: queryForObject бросает EmptyResultDataAccessException вместо нужного нам null."


fonto [19 hours ago]
Точно


fonto [19 hours ago]
Пропустил видимо)


fonto [19 hours ago]
Спасибо


KaryNaiKo [Yesterday at 10:42 PM]
Как SimpleJdbcInsert понимает какае значение в какое поле инсертить?
Ну создали мапу, ну добавили ключ=значения. Вставка происходит по ключу? Так названия ключей не такие как названия полей в базе. По сущности? 
А как тогда вставляется userId? Его нет в meal. (edited)


28 replies
Tanya [16 hours ago]
внимательно посмотри на sql-запрос


Taras [16 hours ago]
1. Когда ты настраиваешь `SimpleJdbcInsert`, ты передаешь ему `.usingGeneratedKeyColumns("id")`
2. Почему ключей? У нас один первичный ключ - `id`
3. `user_id` вставляется в мапу, как и все остальные параметры: `.addValue("user_id", userId)`, ты его вместе с объектом `Meal` передаешь в метод `save()`. В `Meal` его нет и быть не должно.



Sergey Zhukov [16 hours ago]
@Taras почему нельзя в meal добавить userId?

Gekov Iliya [16 hours ago]
@Sergey Zhukov Можно, просто он не нужен для контроллера и отображения, у нас же user id приходит с авторизацией

Sergey Zhukov [16 hours ago]
я про таблицу в базе


Gekov Iliya [16 hours ago]
Так речь у Тараса шла про класс, а не про таблицу (edited)


Sergey Zhukov [16 hours ago]
ну я и в класс Meal добавил поле userId


Taras [16 hours ago]
Именно так. Как я понял, в дальнейшем будет что-то вроде `@ManyToOne User user`, когда этот класс станет полноценныи Entity. А пока что в классе это совершенно лишняя информация (на этом этапе).


Gekov Iliya [16 hours ago]
@Sergey Zhukov в материалах к заданию Григорий отдельно отмечает, что этого делать не нужно было


Dima [16 hours ago]
когда делаешь many to one , то в таблицу надо вставить user_id


Taras [16 hours ago]
Вот даже подсказка была:
>3.2. userId в класс Meal вставлять НЕ надо (для UI и REST это лишние данные, userId это id залогиненного пользователя)


Sergey Zhukov [16 hours ago]
получается придется делать 2 таблицы meals и таблицу для связи user_id и meal_id (edited)


Taras [16 hours ago]
@Dima Это JPA само сделает. А сейчас мы `jdbcTemplate` “мучаем“.


Dima [16 hours ago]
само jpa не создаст поле колонку в таблице. Оно к нему обращаться будет


Taras [16 hours ago]
@Sergey Zhukov Вспомни, на предыдущем шаеге как мы InMemory.. разруливали — тоже `Meal` не меняли.


Gekov Iliya [16 hours ago]
Зачем? Просто добавляем в таблицу к meal поле user_id и все


Gekov Iliya [16 hours ago]
И вяжем его с таблицей users


Sergey Zhukov [16 hours ago]
@Taras а я менял, вроде не запрещено)


Taras [16 hours ago]
@Gekov Iliya Правильно!

Taras [16 hours ago]
@Sergey Zhukov Пункт 3.2 задания.


Sergey Zhukov [16 hours ago]
да поле то я добавил в таблицу и связал уже, но по логике и в классе поле нужно делать


Taras [16 hours ago]
Да и на самом деле он не нужен. Мы всегда работаем с едой какого-то конкретного пользователя.


Gekov Iliya [16 hours ago]
Зачем? Какую оно функцию будет выполнять как поле объекта Meal?


Dima [16 hours ago]
в Spring JPA в Meal надо только сделать User user с аннотацией Many to One


Sergey Zhukov [16 hours ago]
да, сейчас админ у нас не лезет в чужую еду, тока юзеров разруливает, но хочется пологичнее сделать


Gekov Iliya [16 hours ago]
Если судить по итоговому приложению, он этого и не будет делать. Плюс Григорий об этом говорил в одном из видео, что он решил, что админ не будет лезть в еду пользователя


Dima [16 hours ago]
Логично, что админ может управлять юзерами, а их едой не за чем


Sergey Zhukov [15 hours ago]
админ должен управлять всем


Alexey_b [Yesterday at 11:17 PM]
Не могу сделать пункт  3.3. JbdcTemplate работает через сеттеры. Вместе с конструктором по умолчанию их нужно добавить в Meal.  Добавляю конструктор в Meal, убираю модификаторы final c полей класса, но они при обращении к дефолтному конструктору сетятся нулями. Что подразумевается тут сделать? (edited)


29 replies
ABaykov [16 hours ago]
https://javarevisited.blogspot.com/2014/01/why-default-or-no-argument-constructor-java-class.html

вот тут хорошо написано, для чего тебе default constructor
javarevisited.blogspot.com
Why Default or No Argument Constructor is Important in Java Class
Almost all Java developers knows that compiler adds a default constructor or better known as no argument constructor in every Java class, b... (8 kB)


pal548 [16 hours ago]
а сеттеры ты добавляешь?



Alexey_b [16 hours ago]
сеттеры добавил для jdbcTemplate, для остальных уже были


Alexey_b [16 hours ago]
результатом того что я написал, пока является пустая таблица при getAll


ABaykov [16 hours ago]
А как у тебя SQL запрос написан?


Alexey_b [16 hours ago]
return jdbcTemplate.query("SELECT * FROM meals", ROW_MAPPER);

ABaykov [16 hours ago]
и в классе Meal есть конструктор без параметров и сеттеры для всех полей, так?


Gekov Iliya [16 hours ago]
А в базе данные то есть? Если просто выполнить sql запрос из консоли все ок?


Alexey_b [16 hours ago]
да, там есть 4 записи

Alexey_b [16 hours ago]
мне кажется проблема в дефольном констркторе
Pasted image at 2018-10-22, 11:38 PM



Ilya [16 hours ago]
проблема в том что в meal у тебя нет сеттеров для полей, кроме id, который в абстрактном классе

Dima [16 hours ago]
getAll чего используешь? в нем же надо еще user_id ставить, а в запросе у тебя этого не видно

Gekov Iliya [16 hours ago]
RowMapper инициализирован Meal.class-ом?

ABaykov [16 hours ago]
@Dima user_id позже вставит) ему бы сначала получить список Meal

Это уже будет следующий шаг) (edited)


Alexey_b [16 hours ago]
спасибо, действительно не было сеттеров на старые поля, давно еще делал геттеры и решил что и сеттеры там же


Alexey_b [16 hours ago]
одна голова хорошо, а много лучше)



ABaykov [16 hours ago]
Ну а теперь нужно задействовать user_id  и немного подпилить sql запрос)

Alexey_b [16 hours ago]
нет, теперь нужно срочно спать)

oleg_sv [15 hours ago]
А у меня наоборот, все поля вытягиваются из базы нормально, а mealId - всегда null, с чем это может быть связано, кто знает?


pal548 [15 hours ago]
см в консоли что пишет драйвер постгреса. Он пишет, какие поля установились, какие нет


Ilya [15 hours ago]
@oleg_sv проверь унаследован ли meal от AbstractBaseEntity и его сеттер или возможно у тебя в базе поле имеет имя не id

Dima [15 hours ago]
База Heroky как раз дана, чтоб все повторить в своей базе

oleg_sv [15 hours ago]
@Ilya спасибо, ты оказался прав - у меня в таблице ключ назывался meal_id. Со сменой имени заработало. Но теперь я не понимаю, почему можно называть только "id" это ограничение самой sql, или я где-то неправильно связал ключи и поля?


Gekov Iliya [15 hours ago]
У нас поле id в Meal унаследовано от AbstractBaseEntity, а оно там называется просто id

Ilya [15 hours ago]
пункт 10 в разделе проверка HW03

Ilya [15 hours ago]
если хочешь называть по разному, то тогда придется самому обходить ResultSet


Dima [15 hours ago]
RowMapper, который ты ставляешь в каждый запрос пытается парсить базу по полям твоего Meal. у классе Meal нет поля userId


Ilya [15 hours ago]
и сопостовлять


oleg_sv [15 hours ago]
теперь всё понятно, всем спасибо


Sergey Zhukov [Today at 1:03 AM]
В getBetween получается чтобы захватить весь день приходится ставить ... AND date_time<? и передавать параметр endDate.plusDays(1).toLocalDate()
Можно проще записать? (edited)


7 replies
Gekov Iliya [14 hours ago]
AND datetime BETWEEN ? AND ?



Sergey Zhukov [14 hours ago]
точно :slightly_smiling_face:


Gekov Iliya [14 hours ago]
Главное не забывать во время написания тестов, что время тоже участвует в этом сравнении, я немало времени потерял, пытаясь понять, что не так) В реальной работе приложения это не составляет проблему, так как в getBetweenDates MealService проставляются минимальные и максимальные значения для времени


Ilya A. Kvyatkovsky [14 hours ago]
Timestamp в LocalDateTime как конвертируете? Из того что нашел, как-то длинновато получается. Может есть более лаконичный вариант!? (edited)


Gekov Iliya [14 hours ago]
Никак, само справляется


Sergey Zhukov [14 hours ago]
@Ilya A. Kvyatkovsky не надо конвертить, так передавай в запрос


Ilya A. Kvyatkovsky [14 hours ago]
Сорян, Timestamp библиотека кривая подтянута. Подключил java.sql.Timestamp теперь "само" работает) (edited)


Vlad [Today at 1:53 AM]
Добрый вечер всем) У меня появился вопрос, по поводу 1 пункта задания. У меня не работает создание бина JdbcUserRepositoryImpl, я для него установил Qualifier. Так же заметил, что проблема в создание  JdbcTemplate, так как для него не установлен Qualifier. Но так как класс не наш, я не могу его изменять, может кто подскажет как решить проблему?




Код ошибки:
[ERROR] ru.javawebinar.topjava.web.InMemoryAdminRestControllerTest  Time elapsed: 0.094 s  <<< ERROR!
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcUserRepositoryImpl' defined in file [E:\Java\topjava\target\classes\ru\javawebinar\topjava\repository\jdbc\JdbcUserRepositoryImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'org.springframework.jdbc.core.JdbcTemplate' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
    at ru.javawebinar.topjava.web.InMemoryAdminRestControllerTest.beforeClass(InMemoryAdminRestControllerTest.java:23)
Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'org.springframework.jdbc.core.JdbcTemplate' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
    at ru.javawebinar.topjava.web.InMemoryAdminRestControllerTest.beforeClass(InMemoryAdminRestControllerTest.java:23)


6 replies
Илья Чиликин [12 hours ago]
Qualifier не нужен, если у тебя один класс-кандидат на роль бина. Проблема именно в создании JdbcTemplate, а невозможность создания твоего repository - это следствие.


oleg_sv [12 hours ago]
Возможно, проблема в конфигурации, которую ты используешь при запуске приложения. Судя по наличию MemoryAdminRestControllerTest в стек-трейсе, ты запускаешь SpringMain, который остался только для тестов. Попробуй сменить конфигурацию на Tomcat-local (edited)

Ilya [6 hours ago]
для решения этой проблемы я скопировал конфигурацию спринга в ресурсы папки тест и назвал spring-app-test.xml и во всех тестовых классах где происходит подключение контекста спринга указал использовать его (edited)


Ilya [6 hours ago]
с заменой ru.javawebinar.**.repository.jdbc на ru.javawebinar.**.repository.inmemory

Vlad [3 minutes ago]
Класс JdbcUserRepositoryImpl не может создаться так как не может создаться JdbsTemplate который у репозитория находиться в конструкторе с пометкой autowired. Пробовал решить проблему через создание отдельного spring xml  для тестов.  А так же через добавление qualifier и в spring-app использовал ru. javawebinar.**.repository


Ilya [< 1 minute ago]
файл spring-db.xml есть в ресурсах?


Pavel Mikhalev [7:31 AM]
@Grigory Kislin, заметил, что у нас в User используется java.util.Date, хотя в Meal и до этого мы использовали java 8 LocalDateTime. По ссылке описано как работать с Local Date https://jdbc.postgresql.org/documentation/head/8-date-time.html. Думаю, что это часть задания :slightly_smiling_face:
jdbc.postgresql.org
Using Java 8 Date and Time classes
The official site for the PostgreSQL JDBC Driver


Marat Tagirov [Today at 11:26 AM]
у меня одного после накатки всех патчей занятия стал вылетать такой Exception при поднятии томката и попытке в браузере посмотреть еду пользователей?
java.lang.NullPointerException
    ru.javawebinar.topjava.util.MealsUtil.getFilteredWithExcess(MealsUtil.java:37)
    ru.javawebinar.topjava.util.MealsUtil.getWithExcess(MealsUtil.java:29)
    ru.javawebinar.topjava.web.meal.MealRestController.getAll(MealRestController.java:47)
    ru.javawebinar.topjava.web.MealServlet.doGet(MealServlet.java:88)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:635)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:742)
    org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)


6 replies
Gekov Iliya [4 hours ago]
IMG_20181023_112728.jpg



Gekov Iliya [4 hours ago]
Откуда еда пользователя возьмется, если класс репозитория через ДБ пустой, его надо самостоятельно реализовывать


Marat Tagirov [4 hours ago]
да, я продебажил и увидел, что постоянно возвращается null. просто смутило немного, что накатка патчей привела проект в "нерабочее" состояние)


Marat Tagirov [4 hours ago]
блин, я слепой.


Gekov Iliya [4 hours ago]
Ну для того чтобы смущения не было, это отдельно отмечено в материалах жирным шрифтом)


Marat Tagirov [4 hours ago]
это же в описании есть. спасибо)


Marat Tagirov [Today at 11:30 AM]
вообще, дебаг показал, что метод getAll в JdbcMealRepositoryImpl всегда возвращает null. Так и задумано?


1 reply
Ilya A. Kvyatkovsky [3 hours ago]
Нет, там нужно реализовать сортированную выборку из базы для текущего пользователя -> все выбранные строки должны корректно мапиться по ROW_MAPPER -> метод возвращает List<Meal> (и все это помещается в одну строку) смотри аналогии в JdbcUserRepositoryImpl (edited)


Janna S [Today at 2:28 PM]
всем привет!
Напомните плиз кто знает
Если я подключилась сейчас
я накатываю все патчи с урока номер 0?


1 reply
Ilya [1 hour ago]
Привет, да все с 0го


Janna S [1 day ago]
просто выглядит так как буд-то все есть что касается 3 урока  ..
Снимок экрана 2018-10-23 в 3.55.19 ПП.png



Janna S [1 day ago]
я не в тот репозтторий смотрю, так?


Janna S [1 day ago]
так вижу


Taras [1 day ago]
Сложно сказать, что там у тебя.. Накати патчи один за одним, сравни с тем, что написано в тексте. Не забудь создать src/test в соответствующем разделе.


Janna S [1 day ago]
у меня др проблема


Janna S [1 day ago]
я повторно
те уже все есть и репозиторий и тд
теперь либо ждать до 5 урока
либо попутаться сделать un fork и все с нуля
что я и хотела ..


Grigory Kislin [1 day ago]
@Janna S можешь уже с патчами взять из https://github.com/JavaWebinar/topjava (edited)


Taras [1 day ago]
@Janna S А-а, я понял, ты склонировала текущее состояние master. Там патчи накатаны.


Janna S [1 day ago]
ага и можно там дальше уже создавать ветки начиная с HW-3
так ?


Janna S [1 day ago]
спасибо


Taras [1 day ago]
Если хочешь последовательно пройти сама с самого начала (и заодно попробовать самостоятельно ДЗ сделать), возьми отсюда нужный тебе коммит: https://github.com/JavaWebinar/topjava/commits/master


Taras [1 day ago]
Например, начальное состояние проекта (после Prepare_to_HW0, когда надо сделать HW0) — https://github.com/JavaWebinar/topjava/tree/0ae37b48bc68e286028d84e5d2188c0afb7f4eb2


Taras [1 day ago]
клонируешь себе, далее делаешь для каждой домашки отдельную ветку HWnn, а в master заливаешь патчи один-за-одним. Удачи!


Janna S [21 hours ago]
спасибо!!


Sergey Zhukov [Oct 23rd at 4:31 PM]
кто как сравнивал еду в тестах с эталонами? через toString ?


22 replies
Gekov Iliya [1 day ago]
Также как Григорий показывал на примере User, AssertJ вроде библиотека


Sergey Zhukov [1 day ago]
org.assertj.core.api.Assertions.assertThat ? он вроде только id сравнивает, я пробовал менять поля в эталонах - тест не валится


Gekov Iliya [1 day ago]
Там куча методов, сравнивать каждое поле, сравнивать только определенные поля, сравнивать своим компаратором, сравнивать дефолтным компаратором, на каждый случай найдется подходящий)


Sergey Zhukov [1 day ago]
сейчас гляну что там за методы есть)


Sergey Zhukov [1 day ago]
спасибо


Gekov Iliya [1 day ago]
Кода перед глазами нет, не могу точно сказать, там есть методы, которые каждое поле сравнивают


Sergey Zhukov [1 day ago]
ну да в еде надо все сравнить


Taras [1 day ago]
@Sergey Zhukov Посмотри `UserServiceTest`, как там объекты и списоки между собой сравниваются.


Sergey Zhukov [1 day ago]
вот нашел такой isEqualToComparingFieldByFieldRecursively
:slightly_smiling_face: работает (edited)


Gekov Iliya [1 day ago]
:+1: аналогичные есть для сравнения коллекций


Raisa [1 day ago]
как коллекции сравнивали? .usingFieldByFieldElementComparator().isEqualTo(expected);?


Gekov Iliya [1 day ago]
.usingDefaultElementComparator()



Raisa [1 day ago]
заработало, спасибо


Gekov Iliya [1 day ago]
@Raisa я дико извиняюсь, ввел в заблуждение, еще раз перепроверил, для коллекций usingDefaultElementComparator() не подходит, тот, что вы изначально указали - подходящий


Raisa [1 day ago]
@Gekov Iliya ничего страшного, я же и сама стараюсь думать :slightly_smiling_face: у тебя не падает с ним тест? (edited)


Gekov Iliya [1 day ago]
Нет, вроде все ок

Raisa [1 day ago]
у меня падает именно на этом методе с ошибкой (это create тест): java.lang.AssertionError:
Expecting:
<[Meal{id=100009, dateTime=2018-01-03T08:00, description='Завтрак', calories=500},
   Meal{id=100005, dateTime=2018-01-02T08:00, description='Завтрак0', calories=510},
   Meal{id=100004, dateTime=2018-01-01T17:00, description='Ужин0', calories=510},
   Meal{id=100003, dateTime=2018-01-01T12:00, description='Обед0', calories=1000},
   Meal{id=100002, dateTime=2018-01-01T08:00, description='Завтрак0', calories=500}]>
to be equal to:
<[Meal{id=100009, dateTime=2018-01-03T08:00, description='Завтрак', calories=500},
   Meal{id=100005, dateTime=2018-01-02T17:00, description='Завтрак0', calories=510},
   Meal{id=100004, dateTime=2018-01-01T17:00, description='Ужин0', calories=510},
   Meal{id=100003, dateTime=2018-01-01T12:00, description='Обед0', calories=1000},
   Meal{id=100002, dateTime=2018-01-01T08:00, description='Завтрак0', calories=500}]>
when comparing elements using field/property by field/property comparator on all fields/properties
Comparators used:
- for elements fields (by type): {Double -> DoubleComparator[precision=1.0E-15], Float -> FloatComparator[precision=1.0E-6]}
- for elements (by type): {Double -> DoubleComparator[precision=1.0E-15], Float -> FloatComparator[precision=1.0E-6]}
but was not.


Gekov Iliya [1 day ago]
У вас meal c id 100005 отличается по времени)

Gekov Iliya [1 day ago]
Значит тест работает как надо)

Raisa [1 day ago]
точно :smile::+1:

Raisa [1 day ago]
спасибо, нужно быть внимательнее

Nikita Ganin [1 day ago]
Только сейчас проверил, если поменять какое-нибудь поле в эталонных данных, то тесты не проходят. Делал по аналогии с тестами для UserService. Дополнительные методы не использовал.


Sergii Oct 23rd at 5:10 PM
4 Проверить работу MealServlet, запустив приложение - это "затомкатить" , подергать, закрыть, проверить что изменения еды попали в базу ? (edited)

Gekov Iliya 1 day ago
Да

Sergii 1 day ago
Спасибо


Стецко Максим [Oct 23rd at 5:25 PM]
осталось только тесты доделать, дак блин чем больше изучаю, тем больше понимаю что дофига еще не знаю, прям печаль


30 replies
Dima [1 day ago]
у меня как-то наоборот. Я понимаю,что нифига не знаю и поэтому хочу знать еще больше


Стецко Максим [1 day ago]
Я про тоже) Хоть новое и изучается, но такая куча всего еще остается)


Стецко Максим [1 day ago]
даж про которые еще не знаешь даже пока)


Gekov Iliya [1 day ago]
Учитывая с какой скоростью появляется новое и устаревает прошлое, никогда все и не узнаешь, надо как то приспосабливаться к перманентному состоянию обучения)


Dima [1 day ago]
вот и я ща читаю спринг 5 ин экшн и параллельно ангуляр.


Gekov Iliya [1 day ago]
Мы  вот активно спринг изучаем, а мне преподаватель на других курсах сказал, что спрингу скоро придет конец как популярному фреймворку, прав он, не прав, кто знает)


Gekov Iliya [1 day ago]
Хотя глядя на статистику в это слабо верится


Dima [1 day ago]
каждый хвалит свое поле как гворится) Придет так придет, главное вовремя поменять билеты на поезд разработки)


Valery.Shkerdin [1 day ago]
А на работу возьмут ))) может быть совсем другим будешь заниматься, например, другой фреймворк использовать ))) Путь программиста постоянная гонка за новыми знаниями )))


Grigory Kislin [1 day ago]
>  чем больше изучаю, тем больше понимаю что дофига еще не знаю
это нормально, есль же даже картинка на моих вебинарах. начинаешь взрослеть:)
http://javaops.ru/view/resources/tobe-programmer
https://docs.google.com/presentation/d/1YwtCCZsaGMdl-V15kTDHiJxiS52IAl-qqheNPpiNr54/edit#slide=id.g2c68387d9a_1_34
Java Online Projects
Видео: быть программистом: от детства к зрелости
Java программист:от новичка до профессионала. Бесплатные первые занятия. Core,Web,Веб,Maven,Spring 5,Security,JPA(Hibernate),REST,AJAX,Botstrap,Enterprise (29 kB)


fonto [1 day ago]
@Gekov Iliya и какой тогда по его мнению придет на смену Спринга?;)


Dima [1 day ago]
по идее Summer Framework )



Gekov Iliya [1 day ago]
Не помню, давно это было, я тогда еще Спринг от Стринга и Стринг от Свинга не отличал)


fonto [1 day ago]
Ну я уже понял, что зная один фреймворк, на другой перейти не сложно), так что это не проблема) (edited)


shomnest [1 day ago]
@Dima,что за спринг 5 ин экшен?


Dima [1 day ago]
@shomnest Spring in Action 5th


Dima [1 day ago]
я свежатину читаю, 5 версию


Dima [1 day ago]
там не то, что xml, уже javaConfig старье, только spring boot и аннотации


shomnest [1 day ago]
Уже вышла что ли книженция? Вроде в ноябре должна была быть или я запутался в месяцах) на Амазоне заказывал?


Gekov Iliya [1 day ago]
Такими темпами скоро в спринге просто будет одна кнопка по середине экрана "Сделать красиво")


Dima [1 day ago]
спер по ссылке друга с канала JavaOps.
PDF
Spring in Action 5th149.pdf
18 MB
PDF
 Click to view




Dima [1 day ago]
читайте други!!



Стецко Максим [1 day ago]
Я все собираюсь поучить создание интерфейсов, сразу на JavaFX учить, или свинг пока еще актуален?


Gekov Iliya [1 day ago]
Мне кажется десктопные приложения вообще тихонько умирают) я бы лучше андроид попробовал)



shomnest [1 day ago]
@Стецко Максим electron

Стецко Максим [1 day ago]
@Gekov Iliya ну вдруг надо будет програмку написать, мы ща пишет как тонкий клиент, а можно реализацию толстого сделать.


Gekov Iliya [1 day ago]
@Стецко Максим ради интереса вбил на hh.ru, swing упоминается в 42 вакансиях по всей России, javaFx в 10)


Стецко Максим [1 day ago]
хм) значит только поиграться для домашнего пользования)


Sergey Zhukov [1 day ago]
@Dima JavaConfig рано со счетов списывать, SpringBoot его использует :grinning:


Dima [1 day ago]
та это понятно, но бины уже автоматом попадают в контекст, только укажи одну из аннотаций @Component. Только разве чтото подкрутить специфическое (edited)


Raisa [Oct 23rd at 6:47 PM]
подскажите, что значит в мавене [ERROR] Tests run: 23, Failures: 0, Errors: 3, Skipped: 0, что за ошибки? когда запускаю тесты без мавена - проходят без ошибок


7 replies
Taras [1 day ago]
Ищи в логи вот такие строки:
```[ERROR] Failures: 
[ERROR]   UserServiceTest.delete:61 
Expecting:
 <[User (id=100001, email=admin@gmail.com, name=Admin, enabled=true, roles=null, caloriesPerDay=2000)]>
to be equal to:
 <[User (id=100001, email=admin@gmail.com, name=Admin, enabled=true, roles=[ROLE_ADMIN], caloriesPerDay=2000),
    User (id=100000, email=user@yandex.ru, name=User, enabled=true, roles=[ROLE_USER], caloriesPerDay=2000)]>
when comparing elements using field/property by field/property comparator on all fields/properties except ["registered", "roles"]```


Taras [1 day ago]
По логу видно, где ошибка: `UserServiceTest.delete:61`
… у тебя не так, это я специально, чтобы показать, сделал… :slightly_smiling_face:


Raisa [1 day ago]
спасибо :slightly_smiling_face: а то там огромная простыня выпадает с разными ошибками, не понятно толком где смотреть :exploding_head:


Taras [1 day ago]
Лучше для разработки запускай весь пакет тестов вот так. Будет удобно: видно, какие не прошли.
Pasted image at 2018-10-23, 7:18 PM




Taras [1 day ago]
Мавеновский “прогон” больше для всяких разных автоматизированных тулзов проходит, или когда важен просто факт — проходит/не проходит, для принятия дальнейшего решения (`install`, `deploy` и т.п.)


Raisa [1 day ago]
ура, пофиксила все тесты, спасибо


Taras [1 day ago]
:smiley:


Dima Pugovkin [Oct 23rd at 8:54 PM]
pom.xml сломался депенденси не пашут кто знает как победить это беду?
Screen Shot 2018-10-23 at 19.53.19.png



19 replies
Gekov Iliya [1 day ago]
Пробовал Reimport All Maven Projects?

Dima Pugovkin [1 day ago]
в первую очередь - ноль эффекта


Gekov Iliya [1 day ago]
Попробуй еще в идее File -> invalidate caches and restart


Dima Pugovkin [1 day ago]
тоже сделано


Raisa [1 day ago]
у меня было такое после накатки патча 3_08, откатила патч, накатила обратно - все подтянулось


Dima Pugovkin [1 day ago]
пробовал перекатывать патчи - не помогло


Gekov Iliya [1 day ago]
а сам проект то работает?


Raisa [1 day ago]
еще можно попробовать свой мавен поставить вместо родного мавена идеи


Gekov Iliya [1 day ago]
Можно еще удалить все зависимости из pom, подождать пока он обновится и обратно скопировать


Dima Pugovkin [1 day ago]
проект не работает

Dima Pugovkin [1 day ago]
удалил депенденси, вставил заново - теперь ругается на КАЖДУЮ :slightly_smiling_face: не может ниодну распознать

Dima Pugovkin [1 day ago]
кажись репо умерло

Gekov Iliya [1 day ago]
может в настройках мавена изменить путь к репозиторию и сделать реаимпорт, я так понимаю он должен будет туда скачать все зависимости заново


Dima Pugovkin [1 day ago]
rm -r ˜/.m2   помогло, все остальные методы до одного места были. странно

Gekov Iliya [1 day ago]
Что за команда?


Dima Pugovkin [1 day ago]
папку с репо скрытую удалил. та у меня на маке пока что каждый пункт идет по принципу “танцуем с бубном пока не надоест”


Dima Pugovkin [1 day ago]
postgresql через homebrew тоже с танцами ставился :+1:

Taras [1 day ago]
@Dima Pugovkin Не обязательно надо было так ставить, там же на официальной странице есть нормальный инсталлятор под Мак. Сижу на Маке, и всё работает как часы. С мавеном — рискну предположить, что, _возможно_, проблема была с правами доступа. Ты там ничего через sudo не ставил? Посмотри, как починить permissions тут: https://macpaw.com/how-to/repair-disk-permissions
MacPaw
How to repair permissions on Mac
If you’ve noticed that your Mac isn't performing at its silky smooth best, disk permissions may be to blame. In this article, we’ll give you the lowdown on what permissions are and show you how to go about fixing the ones that have gone rogue with the help of Disk Utility and CleanMyMac. (141 kB)


Yuri [1 day ago]
@Dima Pugovkin Postgres проще не ставить, а через Docker запустить


regorov [Yesterday at 1:05 AM]
Всем привет! Почему в методах jdbc template repository для получения 1 объекта используются методы query, а не queryForObject? Просто чтобы показать, что так тоже можно?


1 reply
Gekov Iliya [1 day ago]
В материалах занятия написано почему


ABaykov [1:18 AM]
нет, потому что они работают по разному
и понять, почему используется метод query вместо queryForObject, можно почитав сорсы

under4eg [2:59 AM]
`ERROR: syntax error at or near ":"` - почему пробелы не всегда хороши или краткое руководство о том, как выкинуть 3 часа из своей жизни.... :slightly_smiling_face:


Marat [Yesterday at 7:35 AM]
Подскажите как использовать второй параметр userId в методах JdbcMealRepositoryImpl ?
public boolean delete(int id, int userId) {
       return jdbcTemplate.update("DELETE FROM meals WHERE id=?", id) != 0;
   }


2 replies
Dima [1 day ago]
После слова WHERE условия можно перечислять через AND



Marat [1 day ago]
Понял, спасибо


Alexey_b [Yesterday at 12:20 PM]
По моему отдельный файл с тестовыми данными к каждому классу избыточен, не лучше ли запихать все в тестовый класс? Ну  или если уж заводить отдельное место, то положить туда всё централизованно, и забирать при надобности ?


2 replies
Taras [1 day ago]
Логично же — тестируем MealService, тестовые данные для него же.. Ничего не пересекается, быстрее въехать. Представь, что у нас под сотню таких сервисов….


Alexey_b [1 day ago]
Наверно с точки зрения MealService, да, согласен. Мне показалось что тестовый файл предполагается для каждого класса


YuriyUh [Yesterday at 12:38 PM]
При реализации 7 пункта из optional, вылетает PSQLException: ERROR: duplicate key value violates unique constraint "meals_unique_date_time_idx" при попытке создать еду с одинаковой датой, это как то надо обрабатывать(н-р пробросить эксепшн до сервлета и там на какуюнибудь страницу отобразить) иль я не верно реализовал?


2 replies
Taras [1 day ago]
Я решил, что это в дальнейшем будет реализовано, мы тут не обрабатываем ошибки. В первом задании я на странице с едой сверху выводил красным текст, переданный в параметре error (если возникла ошибка), но мне сказали, что это не нужно было делать, обработка ошибок будет потом… Можно в контроллере средствами spring mvc перехватить заданный exception и вернуть нужную страницу/код ошибки…


YuriyUh [1 day ago]
Ясно, спасибо


Marat [Yesterday at 12:52 PM]
При запуске выходит ошибка java.lang.NoSuchMethodException: ru.javawebinar.topjava.model.Meal.<init>()
Но в задании нет что нужно этот метод создать


6 replies
Gekov Iliya [1 day ago]
Его и не должно быть, где-то косяк, но я даже не могу предположить как вы такое исключение умудрились получить


Gekov Iliya [1 day ago]
На какой стадии хотя бы оно вылетает?


fonto [1 day ago]
Такое исключение можно получить, вызывая метод у несуществующего класса.


fonto [1 day ago]
Например в мапе по ключу получить объект и вызвать у него метод, но если объект не существует, то вылетит такая ошибка (edited)


Marat [1 day ago]
Разобрался, внимательней прочитал задание - нужно было создать конструктор по умолчанию.


Marat [1 day ago]
И поля сначала сделать не final


Marat [Yesterday at 1:22 PM]
Выполнил основное задание, все фильтры работают, добавление, удаление тоже. Но не разобрался как это все работает. Сделал все по аналогии с пользователем.
Это нормально?


2 replies
Gekov Iliya [1 day ago]
Ну как может быть нормально, если не разобрался)
В материалах есть ссылки на теорию по JDBC, вполне доступно разъяснено
Дальше у нас вообще будет реализация работы с базой, где даже запросы как таковые не придется самому писать и мапить, если сейчас не разобраться, потом вообще будет все казаться магией (edited)


Sergey Zhukov [1 day ago]
Для понимания основы JDBC надо почитать, например, в книге "Хорстманн К., Корнелл Г. - Java. Библиотека профессионала. Т2 - 2014" Главу 4 Работа с базами данных.


Sergey Zhukov [Yesterday at 2:20 PM]
по initDB подскажите, команда CONSTRAINT meals_idx UNIQUE (столбец1, столбец2) я правильно понял, задает уникальность пары значений?


2 replies
Grigory Kislin [24 hours ago]
да. + индексы для поиска по (столбец1) и по  (столбец1, столбец2)


Sergey Zhukov [24 hours ago]
спасибо


under4eg [Yesterday at 7:50 PM]
как вам такое?  java.lang.AssertionError:
Expecting:
<Meal{id=5000, dateTime=2017-05-20T10:00, description='Ужин', calories=1500}>
not to be equal to:
<Meal{id=5000, dateTime=2015-05-30T10:00, description='Завтрак', calories=500}> - при тестинге апдейта с вкидыванием и вытаскиванием в базу совсем новой еды и `assertThat.isNotEqualTo`. для assertj эти два объекта - вполне себе одинаковы (edited)


7 replies
Gekov Iliya [18 hours ago]
Конено одинаковые, у нас equals абстрактного энтити возвращает true если id равны


under4eg [18 hours ago]
о, точно. спасибо)


Gekov Iliya [18 hours ago]
В материалах есть статьи, где объясняется почему так и почему это правильно в случае с энтити и БД


Dima [18 hours ago]
поэтому там в конце урока написано, делать тесты не через Equals


Gekov Iliya [18 hours ago]
Вот эта особенно понравилась: https://web.archive.org/web/20171211235806/http://www.onjava.com/pub/a/onjava/2006/09/13/dont-let-hibernate-steal-your-identity.html



under4eg [18 hours ago]
через Equals никто и не делал, если что)


Gekov Iliya [18 hours ago]
Ну isNotEqualTo и EqualTo - это по сути одно и то же, логика то одна применяется


fibz [Yesterday at 10:17 PM]
как подтягивается конфигурация логгера из logback.xml? Как логгер понимает, что из ресурсов надо брать именно этот файл? (edited)


2 replies
Yuri [16 hours ago]
https://logback.qos.ch/manual/configuration.html


fibz [16 hours ago]
спасибо


Dima [Today at 9:16 AM]
Ща посмотрел реализацию тестов ,возник вопрос. Если есть админ и его еда,не легче ли было использовать именно этот список еды? Чтоб не писать 6 meal'ов,а только два реальных и один фейковый


2 replies
Sergey Zhukov [4 hours ago]
тесты должны быть простые и понятные,
я в своих тестах до кучи финалил отдельно IDшники еды )) по типу ADMIN_MEAL_ID1 ... и юзеру также потом еще еду финалил ADMIN_MEAL1 ...
открываешь тест и видишь что он делает, чьи константы


Dima [2 hours ago]
С таким успехом давайте сто записей наплодим в тестах) для проверки списка достаточно две записи


Pushkin [Today at 10:48 AM]
И в моей ветке и в master после наката патча с решением ДЗ. Запускаю все кнопкой "Play" и ошибка. Если выполнять по одному блоку последовательно - все работает
Populate.db падает
[23503] ERROR: insert or update on table "user_roles" violates foreign key constraint "user_roles_user_id_fkey"
Detail: Key (user_id)=(100000) is not present in table "users".



3 replies
Sergey Zhukov [3 hours ago]
Да там не починены контексты, я так понял нужно донакатить до 4_5_create_inmemory_test_ctx.patch.
Накатывать нужно на master, свою ветку лучше не портить, чтобы было с чем сравнивать. (edited)


Pushkin [2 hours ago]
Контексты у меня в порядке, это точно. Что-то с базой - скрипт как-то непоследовательно выполняется что-ли? Или коммиты надо делать промежуточные, хотя я пробовал вставлят commit; после каждого блока - не помогло


Taras [1 hour ago]
Суть ошибки в том, что у тебя нет записи в таблице users. А ты пытаешься вставить запись в user_roles с этим несуществующим ещё пользователем. И где ты такое в HW3 нашёл?


Sergey [Today at 12:38 PM]
Коллеги - а это нормально что у нас 2 интерфейса (UserService и UserRepository) в цепочке слоев по разному называют один метод? Сначала create, потом save ?
   public User *create* (User user) { return repository. *save* (user);  } (edited)


1 reply
Gekov Iliya [1 hour ago]
Мне кажется да, у нас на слое сервиса две операции - создать и изменить, которые в репозитории по сути сливаются в одну - сохранить