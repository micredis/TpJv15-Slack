Grigory Kislin [1:57 PM]
joined #hw0.

Grigory Kislin [1:57 PM]
set the channel topic: Вступительное занятие https://github.com/JavaOPs/topjava

Tanya [12:02 AM]
joined #hw0 along with 18 others.

GerKir [3:04 PM]
Всем привет! Не понял, куда в итоге дз готовое высылать?)

Andrey [4 minutes ago]
Вроде на гитхаб репозиотрий свой ссылку даешь и проверяют, фидбек в слаке дают


Tanya [3 days ago]
если оплачена проверка, то должна прийти инструкция


Grigory Kislin [3 days ago]
привет! без проверки ДЗ присылать не надо, в начале каждого занятие сравнивайте с моим решением. Но рекомендую взять проверку - обучение будет гораздо эффективнее.  Доплатить за нее можно в личном кабинете javaops.


Nikita Ganin [2 days ago]
Разница только в проверке? Или ещё плюшки есть, если оплатить?


Sergey Zhukov [3:21 PM]
Добрый день. В домашнем задании во второй строке поле UserMealWithExceed.exceed... далее уже говорится "...поле exceeded будет одинаково для всех записей за этот день". Опечатка или намек завести общее статическое поле exceeded?

Sergey Zhukov [3:38 PM]
не статическую

Alexey [3:43 PM]
в этом классе уже есть exceed
зачем заводить еще что то

Alexey_b [3:56 PM]
Не, это точно не опчатка

Alexey [4:02 PM]
имеется ввиду - что значение этого поля у всех экземпляров UserMealWithExceed в один день должно быть аналогичное значение поля exceed, но только в пределах суток, в другие сутки может быть другое значение
может быть я криво формулирую конечно
у всех экземпляров UserMealWithExceed одного дня

Sergey Zhukov [4:09 PM]
я про то что сначала говорят про exceed, потом exceeded, поля там такого нет... опечатка?
вчерась только смотрел первое видео, где советуют уточнять любые мелочи, вот и уточняю ))

Alexey [4:13 PM]
поле могли переименовать, но в видео не отразить
так уж скрупулезно не воспринимай детали
более того ты сам можешь переименовать в HW01 8))

Dima [4:23 PM]
ближе к 27-му надо пересмотреть видосы, а то я уже забыл в чем суть)

Sergey Zhukov [4:45 PM]
окей буду считать что надо у записей всего дня менять поле exceed

Nikita Ganin [5:11 PM]
Так а первое занятие 27го будет? Где-то было написано про 04.10

Dima [5:16 PM]
если за весь день количество калорий перевалило за "caloriesPerDay", то надо у всех UserMealWithExceed за  этот день поле exceed сделать true. Это как я понял


Yuriy [10:32 PM]
По поводу поля exceed, того же мнения.

Sergey Zhukov [10:52 PM]
в классе UserMealWithExceed гетеры и сетеры можно делать?
а они final, ну хотябы гетеры можно?

Alexey_b [11:01 PM]
я думаю можно, а с какой целью?)

Sergey Zhukov [11:06 PM]
я стримом преобразую в колекцию UserMealWithExceed,   ее хочется фильтровать по времени с 7 до 12, но гетера нет чтобы поле времени взять

Alexey_b [11:07 PM]
сначала всё  думаешь преобразовать, а потом уже фильтровать?

Sergey Zhukov [11:08 PM]
так и сделал уже, но с помощью гетера в классе UserMealWithExceed
ответ вроде норм
UserMealWithExceed{dateTime=2015-05-30T10:00, description='Завтрак', calories=500, exceed=false}
UserMealWithExceed{dateTime=2015-05-31T10:00, description='Завтрак', calories=1000, exceed=true}

Alexey_b [11:11 PM]
ну правильное решение узнаем числа 4го, но я преобразовыал только то, что было заранее отфильтровано

Sergey Zhukov [11:12 PM]
я знаю что решение кривое, но потихоньку понимание стримов приходит, завтра может что еще придумаю

Dima [1:48 AM]
Интересно посмотреть решение в одну цепочку стрима

Raisa [7:12 AM]
в итоге должна отображаться и та еда, где не превышено количество калорий? или только та, где превышено?

Raisa [7:21 AM]
название метода getFilteredWithExceeded можно понять как получить только список еды с превышением (exceeded, не exceed). Хотя, скорее всего, имеется ввиду, что там будет видна вся еда - где превышено кол-во калорий, а где нет. Я бы переименовала метод в getMarkedExceeded или что-то вроде того (edited)

Andrew Kalugin [8:12 AM]
Кто-нибудь сделал в один проход? Как посчитать калории одновременно с фильтром??? В два прохода уже давно реализовал, но в один.... явно я что-то не знаю :))

Alexey_b [8:12 AM]
Там будет отображаться та еда, которая находится между заданным временем, а exceed будет браться у всей даты
Я не смог в один проход, но в 2 это тоже O(n)

Andrew Kalugin [8:19 AM]
так та да, это О(n) - но интересно, как это все в один можно запихнуть :slightly_smiling_face:

Alexey_b [8:27 AM]
++

Yuriy [9:24 AM]
Если по всей коллекции mealList, то в один стрим засунул, но внутри ешо дополнительно пара мелких стримов которые работают с отфильтрованными данными, ет считается за одну цепочку, иль все-таки три?)

Andrew Kalugin [9:37 AM]
Если создал отдельный стрим, то думаю это уже не будет считаться одним проходом. Просто получится вложенный стрим.


Nikita Ganin [11:54 AM]
В замечаниях к HW0 написано, что "Сложность должна быть O(N), т.е. без вложенных стримов и циклов"

Sergey Zhukov [12:39 PM]
я пока что сделал с вложенным стримом

Raisa [12:51 PM]
у меня два разных стрима
последовательно

Andrew Kalugin [1:16 PM]
У меня тоже два последовательных стрима. Теоретически мы проходим по условию "Сложность должна быть O(N)". Интересно посмотреть решение от Григория в один.

Alexey [1:32 PM]
не факт что оно от Григория :sunglasses: -может быть от такого же студента как и вы

lifter4ik [1:38 PM]
привет всем! вы тут активно первое домашнее разбираете) ночь вертелся, думал как в один проход все сделать, так и не придумал))
ибо как мы можем знать было превышение в конкретный день или нет, заранее его не вычислив
я первым проходом считал дневные калории в мапу по дню и отбирал завтраки в отдельный список. потом в зависимости уже от превышение по дню вторым проходом выдаем результат
но мне кажется у меня уже не О(n), а что-то типа O(1.3n) прогон по всем входящим записям, а потом еще по трети отобранных фильтром
делал на циклах, сейчас буду резко погружаться в стримы. до этого вообще их стороной обходил))

Raisa [1:48 PM]
на Степике есть курс по стримам, я его сейчас прохожу )

lifter4ik [1:53 PM]
спасибо, гляну
а если два последовательных прохода это разве не O(2n) ?

Raisa [2:03 PM]
наверное, там важно, чтобы асимптотическая сложность была линейной, а не логарифмической или квадратичной. узнаем 27-го )

lifter4ik [2:09 PM]
так логарифмическая будет быстрее же
чем О(n)

Raisa [2:19 PM]
ну да. в задании про линейную говорится, думаю, на О(2n) это тоже распространяется. главное, чтобы вложенности не было )

Anton Potemkin [4:16 PM]
Так не важно О(2n) или О(n), коэфициент при n всегда отбрасывает, т.к. в теории при n близко к бесконечно коэффициент не играет большой роли.

lifter4ik [4:20 PM]
это подтвержденная информация?)

Anton Potemkin [4:26 PM]
https://stackoverflow.com/questions/25777714/which-algorithm-is-faster-on-or-o2n
Stack Overflow
Which algorithm is faster O(N) or O(2N)?
Talking about Big O notations, if one algorithm time complexity is O(N) and other's is O(2N), which one is faster?

lifter4ik [4:31 PM]
просветился, благодарю

nick [4:40 PM]
попробую пояснить, так как я понимаю:
Алгоритм - это последовательность определенных действий, для достижения поставленной задачи.
"Сложность алгоритма O(N)" - показывает линейную зависимость выполнения алгоритма от N. Применимо к нашей задаче, это означает написать алгоритм без вложенных друг в друга циклов, т.к. любой вложенный цикл внутри какого-то алгоритма  автоматически повышает сложность этого алгоритма до N в степени вложенности циклов.
Так-что, если сделать последовательно два прохода по mealList, в первом проходе сгрупировать по датам и вычислить количество калорий для каждого дня, а во втором проходе - отфильтровать и привести к MealWithExceeded, то по отношению к алгоритму в целом это будет O(N), т.к. при увеличении N, сложность будет увеличиваться пропорционально N (а не 2N).
В задаче не сказано сделать за один проход цикла, но сделать сложность O(N)

lifter4ik [4:46 PM]
а в Optional разве не имеется в виду за один проход
Сделать реализацию со сложностью O(N):
- циклом за 1 проход по List<UserMeal>. Обратите внимание на п.13 замечаний
- через Stream API за 1 проход по полному списку Stream<UserMeal>

Anton Potemkin [4:55 PM]
Так смысл был не использовать вложенный цикл. А option это дополнительные задания и там уже нужно попытаться сделать за 1 проход

lifter4ik [4:57 PM]
это-то понятно) но все же как такое возможно

nick [4:58 PM]
Это Optional ))
В п.13 говорится про сортировку, то есть, вместо внутреннего цикла, (где, к примеру, можно еще раз проходиться по списку и считать калории по дням,) можно отсортировать список и сыграть на том, что даты идут по порядку. Но вопрос в том, учитывать ли SomeCollection.sort(), как проход по циклу или нет?
Это мои догадки, я  Optional не сделал еще

Ilya [4:58 PM]
привет! подскажите никак не пойму как в один стрим все логику записать, пока получаю в первом стриме мапу дат и итоговых сум и во втором стреме создаю новую коллекцию

nick [4:59 PM]
это правильно, так раньше было в Григория (я уже не первый раз на TopJava)
а вот про Optional не было))

Ilya [5:02 PM]
в общем да интересно optional2 (edited)

lifter4ik [5:03 PM]
мне кажется сортировка это уже отдельный проход

nick [5:03 PM]
я тоже так думаю

Ilya [5:04 PM]
будет 3n)

lifter4ik [5:05 PM]
на нужно будет тогда те же завтраки пихнуть в конец, либо что бы они были каждым третьим в списке
тогда их сразу и добавлять в результат
в такой реализации и мапа не нужна получается
хотя не, сумму надо ж все равно хранить
или если каждым третьим в списке, тогда локальный счетчик в принципе пойдет, обнулять после добавления
но это все узкая реализация, что-нибудь в модели поменяется, и все поедет лесом
полдники добавят))

nick [5:15 PM]
Ilya [5:04 PM]
будет 3n)
Вопрос в том как смотреть на алгоритм, если внутри алгоритма куча циклов, сортировок, еще какой-то ерунды, а сложность растет линейно, то есть, при N = 1, алгоритм работает 2с., при N = 5, алгоритм работает 10с., при N = 50, алгоритм работает 100с., то сложность этого алгоритма O(N) (это в общем)
Если разобрать алгоритм более детально на части, и для каждой части вычислить ее сложность и просуммировать, то может получится и 2N, 3N, LogN, N в степени и прочее. Но этого не требуется, просто, что бы не было N в степени (то есть без вложенных циклов)

Ilya [5:19 PM]
а зачем тут сортировка? мы и так обходим все элементы

lifter4ik [5:20 PM]
мы ищем решение в один проход))

Ilya [5:20 PM]
для ускорения я бы мапу с итогами по дню хранил бы в самом классе
тогда все юыло бы в один проход

lifter4ik [5:21 PM]
посчитать то эти итоги тоже где-то будет надо

Ilya [5:21 PM]
при добавлении элемента
в классе хелпере
тут либо теряем в памяти либо в скорости

lifter4ik [5:24 PM]
заполнять список через отдельный метод. а может оно и есть такое решение, переписать мейн, в котором заранее мапа накидается
код же не запрещено менять

Ilya [5:25 PM]
вот я о том же)

lifter4ik [5:25 PM]
хитро придумано!)

Ilya [5:26 PM]
тут нужен класс который будет хранить лист еды и в нем же лист итогов
и все

lifter4ik [5:28 PM]
этим классном будет БД)))
классом

Ilya [5:28 PM]
пока до неа не дошли)
нее
будет  in memory

lifter4ik [5:30 PM]
тогда чем тебе TimeUtil не угодил?) переименовать в MealUtil и лепи что хочешь))

Ilya [5:33 PM]
судя по его имени туда лучше пихать фунции работы с датой, всеже надо отделять мух от котлет (edited)

lifter4ik [5:34 PM]
согласен, если таких методов будет много. может isBetween'ом все ограничится в нем)) тогда зачем плодить классы))
скоро такими темпами Григорий не узнает свой проект))

Ilya [5:42 PM]
как минимум там нужен метод который возвращает localData
так что уже два)

lifter4ik [5:43 PM]
погоди локалдата в самом классе локалдататайм есть

Ilya [5:43 PM]
она включает в себя время
а без времени?

lifter4ik [5:48 PM]
.toLocalDate();
.toLocalTime();
вот эти два метода есть в самом LocalDateTime
в LocalDate  поля только год месяц день же
в LocalTime часы минуты и тд
составной класс на два разбивается и все, я так понял

Dima [5:50 PM]
может вы в отдельную ветку перейдете?)))

lifter4ik [5:52 PM]
зачем? по заданию обсуждение идет. может будет полезно кому. мы же не о личном)))

Dima [5:52 PM]
ну так то да. тогда выключу звук нового сообщения

Ilya [5:53 PM]
ок тогда не надо)

lifter4ik [5:53 PM]
я везде все выключил давно, так время от времени открываю вкладку посмотреть писал кто может

Dima [5:54 PM]
я без предъяв, если что

lifter4ik [5:55 PM]
ну да, а то распугаешь, будем бояться лишнее слово сказать)))

Sergey Zhukov [8:22 PM]
вместо сортировки можно группировать по дням, но я пока не нашел этому применения, не очень понимаю как потом с этой мапой работать, получается мапа<день, лист<юзермил>>


Dima [Sep 21st at 9:30 PM]
я сделал мапу день = калорииЗаДень, потом ее использовал в формировании результирующего листа


1 reply
Sergey Zhukov [4 days ago]
Пошел этим же путем. Я в итоге сделал с листом, который содержит даты с превышением, тоже его использовал чтобы формировать результирующий, ппц наговнокодил, но как бы в один проход по исходному листу, второй проход был уже по результату из двух искомых записей. Еще в стримы можно только финалы, пришлось использовать коллекцию. А результат основного стрима вообще не брал, в фильтра поместил логику.


Raisa Sep 22nd at 4:51 PM
c <день, лист<юзермил>>можно нужную логику внутри map (element -> { ...}) реализовать (edited)

Sergey Zhukov 4 days ago
группировка - терминальный метод, придется опять в стрим загонять, я решил так не делать, много проходов получится, как не крути, а нужно попытаться в один уложиться


fonto [9:10 PM]
Привет), дз сделал еще пару недель назад. 27 в итоге что делаем?;)

Ilya A. Kvyatkovsky [2:38 AM]
Блин, Optional 2 это взрыв мозга! Лист еще и не сортированный!


This message was deleted.


1 reply
Sergey Zhukov [3 days ago]
с чего бы, это же не терминальный метод


Ilya [10:45 AM]
мне что то кажется что optional2 дан для того чтобы мы как можно больше  почитали про стрим апи. При этом у нас ничего не получиться) потому что решения в O(n) нет

Alexey [10:56 AM]
есть
другое дело что там нет никакого выигрыша относительно двух проходов

Ilya [11:21 AM]
тут в голову пришла идея) как эту штуку обойти... boolean exceed превратить в Boolean[] exceed что даст нам возможность поменять значение при одном проходе, но нужно чтобы список был отсортирован
без стримов работает) за один проход

Ilya [12:05 PM]
в стриме тоже такое провернул, но решение такое себе

Vitaliy Ivkin [6:45 PM]
Привет всем в этом разделе) тут уже вовсю optionalы обсуждаются, а я только сажусь за задачу, посмотрев видео :sweat_smile:
Правильно ли я понял, что на основе передаваемого списка userMeal'ов нужно заполнить и вернуть список userMeal'ов с булином и, если суммарные калории за день превышают заданные в методе 2000, то на последней трапезе с 510 калорий он должен выдать true, т.к. лимит калорий превышен?
*заполнить в случае, если дата находится между заданными в методе

Dima [6:52 PM]
нет, если суммарное количество каллорий за день превышает 2000(в нашем случае) , то все usermeal с булином за этот день должны выдать тру

Vitaliy Ivkin [6:54 PM]
понятно, спасибо. ну и список после фильтрации по времени должен быть отсортирован, по логике

Dima [6:59 PM]
да

Igor [10:44 AM]
Всем привет!
Что думаете по такому решению через stream:
- создаем Map<LocalDate, Integer>, где ключ - день, значение - сумма калорий. Эта карта заполнятся в методе sort() используя merge().
- дальше stream из списка mealList и операции над ним:
       .sort(<заполняем map  и возвращаем результат сравнения DateTime>)
       .filter(<фильтруем по переданным датам>)
       .map(преобразуем объекты UserMeal в UserMealWithExceed. Значение exceed вычисляем по карте)
       .collect(сводим поток в коллекцию)

nick [11:25 AM]
метод sorted() принимает экземпляр Comparator, то есть лямда будет (o1, o2) -> { реализация compare(o1, o2) },
а метод filter() должен работать все с тем же листом UserMeals, то есть метод, который идет перед filter() должен:
- заполнить Map<LocalDate, Integer>
- возвратить List<UserMeals> без изменений
В таком случае, я бы воспользовался методом map(), который принимает  UserMeals, делает какие-то действия, и возвращает этот же UserMeals без изменений
попробовал, работает)) Спасибо за подсказку))
Idea предложила матод map(), который ничего не меняет со стримом, заменить на метод peek()
в итоге все супер

Dima [11:27 AM]
peek для этого и создан, чтобы делать промежуточные манипуляции не трогая основной поток

nick [11:32 AM]
пардон, не работает((
мапа заполняется нормально, но поле ексидед не меняет

Igor [11:33 AM]
Я поэтому и заполняю мапу в sort, а не в map

nick [11:33 AM]
а в sort работает?

Igor [11:33 AM]
Посмотри https://javadevblog.com/polnoe-rukovodstvo-po-java-8-stream.html порядок обработки
javadevblog.com
Полное руководство по Java 8 Stream | Программирование на Java, Android
Это руководство дает не только общее представление о Stream в Java 8, но и полезные знания которые будут востребованы в будущем. Когда я впервые узнал о Stream API, я был удивлен таким названием, поскольку это звучит очень похоже на InputStream или OutputStream из Java I/O. Но Java 8 Stream это совсем другое. Streams

nick [11:34 AM]
спасибо, сейчас гляну

Dima [11:36 AM]
а я сделал в два этапа, вначале создал мапу
mealList.stream().collect(Collectors.toMap(u->u.getDateTime().toLocalDate(),
                                                           UserMeal::getCalories, (a,b)->a+b));
а потом еще одним проходом сделал все остальное

Igor [11:37 AM]
По сложности думаю одинаково. Но это все равно не O(n) как и у меня
Вместо `(a,b)->a+b` можно использовать `Integer::sum`

Dima [11:39 AM]
можно, но мне больше понятнее )

nick [11:42 AM]
Я так тоже сделал (в 2 прохода), но это решение не проходит для Optional2 где нужно за один проход по листу справиться

Dima [11:43 AM]
ну я думаю не всегда надо минимизировать код , надо поддерживать читаемость,чтоб другие с первого раза поняли в чем суть.
так можно вообще сделать утильный класс, который все будет делать сам, и надо только кинуть его в стрим)

nick [11:46 AM]
полностью согласен, но Optional2 - это скорее олимпиадное задание, а не пример хорошего и понятного кода,я так думаю

nick [12:25 PM]
Igor [11:33 AM]
Посмотри https://javadevblog.com/polnoe-rukovodstvo-po-java-8-stream.html порядок обработки

Спасибо, помогло.
Но пришлось поменять UserMeals, и добавить в него новое поле - уникальный ID,
в метод getFilteredWithExceeded() добавить  Set с айдишниками UserMeals,
а в метод sorted() добавить проверку на наличие id UserMeals в Set
Вроде работает, и рефакторить код не запрещалось, но я не знаю или рефакторить UserMeals это правильное решение (edited)

Zarboinik [12:25 PM]
Всем привет

nick [12:26 PM]
привет

Zarboinik [12:26 PM]
Такой вопрос, сюда можно выкладывать свои решения? или лучше не спойлерить?

nick [12:26 PM]
лучше не выкладывать)

Zarboinik [12:26 PM]
окей)

Zarboinik [12:36 PM]
в общем если я правильно понял замечание 13. то нужно из всех UserMeal сделать все UserMealWithExceed. и вывести их одним списком, без сортировки по времени.
И если это так, то это можно сделать в 1 проход.
а вот если еще  и по времени сортировать то я не представляю, как это в 1 проход можно сделать

Dima [12:37 PM]
по времени самое простое) для этого дан класс TimeUtils

Zarboinik [12:38 PM]
но это в 2 прохода делается
сначало ты переделываешь всё в UserMealWithExceed. а потом сортируется по времени

Dima [12:40 PM]
лучше наоборот, чтоб не создавать в куче лишних обьектов


This message was deleted.


7 replies
Vitaliy Ivkin [2 days ago]
Довольно жестоко) я ещё в процессе написания, а тут теперь соблазн открыть чьё-то решение :sweat_smile:
Но как в моём методе станет что-то получаться с удовольствием погляжу)


Igor [2 days ago]
Вложенный stream не айс


Zarboinik [2 days ago]
а по конкретней?


Zarboinik [2 days ago]
как я понял, если из моего решения вывести сразу allexceeds то это получится решение усложненного задания. под п.2 где в 1 проход надо было сделать. А если с сортировкой по времени, то я только такой путь придумал


Igor [2 days ago]
Решение наверняка рабочее. Я имел ввиду, что оно не соответствует условию задания: *через Stream API за 1 проход по полному списку Stream<UserMeal>*


Alexey [2 days ago]
вложенный stream это O(n в квадрате вроде)


Alexey_b [2 days ago]
название allexceeds не по феншую


Vitaliy Ivkin [1:12 PM]
У меня получился достаточно простой фильтр по времени, но при тесте вывода возник закономерный вопрос - метод, который мы пишем, выдаёт информацию НЕЗАВИСИМО от даты, опираясь лишь на переданное время дня, так?

Dima [1:15 PM]
да

Alexey [1:55 PM]
по ТЗ лучше сделать два метода getFilteredWithExceededByCycle и getFilteredWithExceededByStream например


Vitaliy Ivkin [Sep 24th at 2:27 PM]
Создаю UserMeal с булином на основе безбулинного в потоке с помощью .map и ожидаемо натыкаюсь на сложность с этим самым булином. Можно как-то в поток ввести сторонние данные (отдельно посчитанная сумма калорий по дням)? Была мысль сделать для булина поток внутри потока, но это плохая реализация и противоречит ТЗ


2 replies
Igor [2 days ago]
А в чем сложность использования внутри .map() внешних переменных?


Vitaliy Ivkin [2 days ago]
Оказалось - ни в чём) у меня был косяк в другом месте. Сейчас его поправил и всё заработало


Vitaliy Ivkin [Sep 24th at 2:46 PM]
В один не вышло, а в два прохода - вполне. Сделал мапу по рекомендации @Dima, правда внутри неё тоже сделал фильтр по датам, чтобы не добавлялось лишнего. Порекомендуйте, что добавить/убрать, если нужно
https://github.com/Walliword/topjava/commit/b731c8b9ebbdebc6af5fa409af8061309bf83ee7
GitHub
HW0 Completed · Walliword/topjava@b731c8b
Java Enterprise: Maven/ Spring/ Security/ JPA(Hibernate)/ REST(Jackson)/ Bootstrap(CSS)/ jQuery - Walliword/topjava
 


36 replies
Igor [2 days ago]
Мапу можно заполнять в sorted(), тогда первый стрим будет не нужен:
```.sorted((f, s) -> {
                    map.merge(f.getDateTime().toLocalDate(), f.getCalories(), Integer::sum);
                    return f.getDateTime().isAfter(s.getDateTime()) ? 1 : 0;})```
(edited)



Alexey [2 days ago]
мне кажется там ошибка в getFilteredWithExceeded


Igor [2 days ago]
Но `filter()` тогда должен быть после `sorted()`


Alexey [2 days ago]
во первых плохое имя для мапы - map

Alexey [2 days ago]
в мапе окажутся только отфильтрованные приемы пищи - и какой смысле по ним exeed счистать


Vitaliy Ivkin [2 days ago]
С этим у меня кстати возник вопрос - если фильтровать в мапе, то условный пользователь вводит границы времени и видит, что те приемы пищи, что попали в фильтр ничего не нарушают, ведь его в момент поиска не интересует, например, ужин


Vitaliy Ivkin [2 days ago]
а если в мапе не фильтровать, то вот у него условный завтрак на 300 ккал, превышающий предел в 2000 ккал


Vitaliy Ivkin [2 days ago]
если он выбирал только завтраки по времени до 12 дня, например


Yevhen Maksymovych [2 days ago]
вот это зачем?
```map.getOrDefault()```
ты ведь до сгенерил мапу по исходным данным. Если ты переживаешь за атомарность, дескать, кто-то может добавить мил между твоим подсчётом суммарных калорий по дням и отрисовкой милов с эксидами, тогда нужна отдельная логика, потому как в этот период можно добавить приём пищи, заведомо больший эксида, а у тебя для него будет лимит 0



Vitaliy Ivkin [2 days ago]
дефолт справедливо убран, название изменено. а вот насчет фильтрации и нужно ли нам даже на неполный день считать все возможные за день приемы пищи для булина - ещё не ясно


Yevhen Maksymovych [2 days ago]
чего тут не ясного, эксид считаем за день целиком, а выводим - только пищу за указанное окно времени. если человек выбрал завтрак с овсянкой, а на ужин съел четыре чизбурегера с картохой, в овсянке ему показываем, что эксид первышен


Alexey [2 days ago]
exceed это превышение суточной нормы - считать суточную надо по нефильтрованному

Vitaliy Ivkin [2 days ago]
всё понятно, спасибо. тогда и это сейчас исправлю

Vitaliy Ivkin [2 days ago]
https://github.com/Walliword/topjava/blob/HW0/src/main/java/ru/javawebinar/topjava/util/UserMealsUtil.java
GitHub
Walliword/topjava
Java Enterprise: Maven/ Spring/ Security/ JPA(Hibernate)/ REST(Jackson)/ Bootstrap(CSS)/ jQuery - Walliword/topjava
 


Vitaliy Ivkin [2 days ago]
Как по мне - вполне рабочая тема)

Alexey [2 days ago]
у тебя лист на входе сортирован, потому и код работает

Alexey [2 days ago]
а если элементы переставить - то домик индейца


Vitaliy Ivkin [2 days ago]
Значит - править дальше. Спасибо)


Igor [2 days ago]
`sorted` заменить на `.sorted(Comparator.comparing(UserMeal::getDateTime))`
а перед ним вызвать `peek` в котором заполнять мапу


Sergey Zhukov [1 day ago]
тоже дошел до peek )) заполняется мапа одним if, очень компактно

Yuri [1 day ago]
Сортировка не нужна, ее нет в задании

lifter4ik [1 day ago]
так, как я понял, мы ее тут используем, что бы она стрим "подержала" (в силу особенностей работы sorted), дав нам посчитать суммы калорий за день


lifter4ik [1 day ago]
сейчас сделал без peek так:
.filter (бежим заполняем мапу через merge, и по времени фильтруем)
.sorted(для "подержать", ну и отсортирует фильтрованное пусть уж (всяко не весь список мотать)
.map(преобразуем естественно)
.collect(в результат)


Igor [1 day ago]
Сортировка действительно не нужна, но без нее карта будет заполнятся не так как нужно. Я уже приводил ссылку  про порядок обработки в *stream*.


Igor [1 day ago]
@Sergey Zhukov что значит _"заполняется мапа одним if"_?


Vitaliy Ivkin [1 day ago]
Добавил peek по совету @Igor и теперь все сортируется, заполняется и вообще делается как надо в один проход)

Sergey Zhukov [1 day ago]
@Igor Использую переменную типа мап<дата, сумма>. В задании сказано, что на входе лист не отсортирован, ну в стриме сортируем, сортировка будет трогать каждый элемент, потому ставим пик перед сортировкой а в нем условие заполнения мапы, я вставил туда обычный if, не выходя из стрима после сортировки эта мапа используется в мапинге в новый тип элементов. Получается один проход стрима с готовым результатом.


Igor [1 day ago]
@Sergey Zhukov Как используешь `if`? Почему не `map.merge(key, value, remappingFunction)`?

В остальном у меня аналогично. (edited)


Sergey Zhukov [1 day ago]
@Igor хотелось сделать проще, поэтому  if (мапа содержит дату или нет) и кладу в нее значение или прибавляю к существующему
я еще не владею всеми приемами стрима, потом будет рефакторинг (edited)


Igor [1 day ago]
`merge` это метод `Map`.
Вставляет в `map` ключ и значение, если такой ключ уже есть, то применяет к значению функцию. Возвращает новое значение `value`.


Sergey Zhukov [1 day ago]
ну значит заменю


Sergey Zhukov [24 hours ago]
@Igor Спасибо, очень полезный метод, не знаю почему я его раньше не использовал, теперь буду часто


Ilya A. Kvyatkovsky [19 hours ago]
@Vitaliy Ivkin @Igor @Sergey Zhukov
Скажите, что я не понимаю в стриме, который у Вас получился?!
При дебаге я однозначно вижу что .peek сначала проходит по всему mealList и набивает мапу.
После чего .filter повторно проходит по всему mealList где выбирает только те UserMeal которые подходят по времени.
В результате, все те же 2 прохода!
Или в данном примере речь не идет об одном проходе? (edited)


Zarboinik [16 hours ago]
в обще можно считирить и изменить TimeUtil, что бы он при сортировки создавал класс UserMealWithExceed. Тогда технически  в методе getFilteredWithExceeded будет 1 проходка :grin:


Alexey [11 hours ago]
не надо так делать, для подобной цели менять TimeUtil, есть же UserMealsUtil - добавь метод создания туда

Igor [9 hours ago]
Мне тоже кажется, что этот алгоритм не может считаться как один проход.
Да и вообще модифицировать в `stream` внешнюю коллекцию плохой подход. Наверное могут возникнуть проблемы в многопоточном приложении.. (edited)


This message was deleted.


2 replies
Igor [9 hours ago]
Мне кажется, что в `filter` не получится правильно заполнить `Map`, потому что каждый элемент стрима в данном случае обрабатывается последовательно по всем операциям конвейера. И получается когда достаешь из карты калории за день, то карта на самом деле еще не заполнена всеми элементами...

`sorted` перед фильтром позволяет решить эту проблему, поскольку он "не пускает" элементы дальше по конвейеру пока они все не будут обработаны.

Проверяется это очень просто - вставь `println` во все операции конвейера. (edited)


Maxim Valeev [3 hours ago]
Я заполняю мапу как раз в блоке filter, а в этот блок заходят все эелементы. После фильтра элементы помещаются в фильтрованный список. Из которого затем берется другой стрим и из него возвращаешься список с индикатором переедания) (edited)


Alexey [7:15 AM]
бывает что думаешь что работает все отлично - а у тебя просто тесты плохие :sunglasses:

YuriyUh [9:05 AM]
А вот еже ли временной промежуток будет включать в себя все приемы пищи и фактически выйдет все тех же два прохода, это будет считаться за 0(N)?

Maxim Valeev [10:15 AM]
Ну вообще ж O(2N) все равно считается за O(N). Конечно если есть способ сделать все в одном проходе стрима, то будет лучше. Но я не смог это сделать:slightly_smiling_face: Поэтому в у меня в решении только худший вариант выдаст O(2N) (edited)


Стецко Максим [Today at 3:15 PM]
решил потестить быстродействие стрима с 50мил операций (просто сложение чисел), просто через цикл for 14 сек, через стрим 17 сек, через параллельный стрим 28 сек. Очень сильно задумался)


3 replies
Yevhen Maksymovych [3 hours ago]
и стримы для суммирования небось задавал через какой-нибудь IntStream.range()?


Sergey Zhukov [2 hours ago]
из видео по стримам из раздаточного понятно, что стримы в ряде случаев не обгонят старые проверенные решения на циклах, но если правильно их готовить, может что-то получится, причем только на параллел, но удобство ощутимое


Стецко Максим [1 hour ago]
@Yevhen Maksymovych да нет, через reduce делал (edited)


Alexey [3:16 PM]
о наконец то об этом кто то подумал 8))))


Стецко Максим [Today at 3:17 PM]
сижу Шилдта читаю главу по стримы и по ходу тестю)


4 replies
Sergey Zhukov [2 hours ago]
кинь ссылочку плз


Zarboinik [2 hours ago]
PDF
Шилдт Г. - Java 8. Руководство для начинающих - 2015.pdf
112 MB
PDF
 Click to open original




Sergey Zhukov [2 hours ago]
@Zarboinik спасибо


Стецко Максим [1 hour ago]
@Sergey Zhukov Да я покупал книгу недавно, 10 издание, вышло только в конце весны


Marat Tagirov [4:49 PM]
я правильно понимаю, нужно fork этого проекта делать?
https://github.com/JavaOPs/topjava
GitHub
JavaOPs/topjava
Java Enterprise: Maven/ Spring/ Security/ JPA(Hibernate)/ REST(Jackson)/ Bootstrap(CSS)/ jQuery - JavaOPs/topjava

Andrey Tolkachev [4:51 PM]
да

Marat Tagirov [4:52 PM]
спасибо

Grigory Kislin [4:55 PM]
Друзья, привет!
@here
готовился к вебинару и за время моего отсутствия набросали свои решения. удалите плз- еще же не все сделали.
делиться своим решением можно в личку, либо после первого занятия (04.10). Те после разбора
иначе соблазн не далать самому а подглядеть (edited)

Dima [4:57 PM]
Григорий, скажи как будет дальше формироваться проект на гите, каждое задание отдельно или все сливать в мастер потом?

fonto [5:10 PM]
В userMeal дополнительный гетер для LocalDate можно добавлять? Для метода референс, чтобы было покрасивее?

Стецко Максим [5:10 PM]
хм если бы не поле exceed то спокойно можно 1 стримом переделать список, а пока как у все в 2 строки решение:

Grigory Kislin [5:12 PM]
@Dima правила ведения есть в вступительном занятии. смотреть все видео- обязательно. там же есть ссылка: https://github.com/JavaOPs/topjava/wiki/Git#Как-вести-проект-у-себя-в-локальном-проекте
GitHub
JavaOPs/topjava
Java Enterprise: Maven/ Spring/ Security/ JPA(Hibernate)/ REST(Jackson)/ Bootstrap(CSS)/ jQuery - JavaOPs/topjava
@fonto я помоему специально где-то говорю и в замечаниях должно быть: менять можно и даже нужно

fonto [5:14 PM]
@Grigory Kislin если я один стрим вынесу в отдельный метод, это будет считаться за один проход?;) И во сколько завтра собираемся? (edited)


Dima [Today at 5:14 PM]
@Grigory Kislin та это понятно) ветку сделал, на мастер обратно перешел, меня интересовало потом как будет. На каждое занятие своя ветка? а в мастере то что с патчем будет приходить?


4 replies
Grigory Kislin [1 hour ago]
картинка есть по ссылке выше


Dima [1 hour ago]
у меня отельный фаервол блокирует гит) приходится переходить на телефонный инет, ок, посмотрю,спасибо


Grigory Kislin [33 minutes ago]
вообще у нас все на git будет.. поставь обходчик какой нибуддь. или через анонимайзер. с телефона все тяжело смотреть будет (edited)


Dima [31 minutes ago]
инет тут недорогой)справлюсь


Grigory Kislin [1:32 AM]
-----------------------------------------------------------------------------------
*ВНМАНИЕ: в Optional2 сделал правку:*
*- через Stream API за 1 проход по полному списку Stream<UserMeal> + возможно дополнительные проходы по частям списка*
----------------------------------------------------------------------------------- (edited)


Ilya A. Kvyatkovsky [Today at 1:38 AM]
UserMeal - entity - упустил. Спасибо (edited)


2 replies
[9 hours ago]
1) UserMeal  - это entity, там не должно быть логики.
2) что из себя будет представлять totalDayCalories? каким образом там будут храниться актуальные данные?


Igor [8 hours ago]
Тоже вчера была такая мысль, даже начал делать, но потом отказался. Ведь объекты _UserMeal_ могут создаваться и уничтожаться непредсказуемое количество раз.. И какая информация будет тогда в _totalDayCalories_?


Taras [8:07 PM]
Для проверки своего решения я добавил в `UserMeal` статические поля-счётчики, которые инкрементируются при обращении к _getters_ соответствующих полей. В тестах сделал генератор массива, в который загоняю 3001 данное. Получил такие результаты:
Когда в `List<UserMealWithExceed>` попадает только одна запись:
Calories count: 3002
DateTime count: 6003
Description count: 1
Когда в `List<UserMealWithExceed>` попадают все записи:
Calories count: 6002
DateTime count: 9003
Description count: 3001
Нормально?

Alexey [8:30 PM]
несколько раз перечитал - нифига не понял
что то мне подсказывает если непонятно - то что то неправильно

Gekov Iliya [8:42 PM]
Да вроде понятно, просто счетчики количества обращения к геттерам

roma [10:09 PM]
привет всем

Sergey Zhukov [10:10 PM]
привет

Sergey Zhukov [10:17 PM]
@Taras а зачем все это? расчет сложности твоего алгоритма? кусок кода а студию, как мы узнаем в каких методах ты поля трогаешь (edited)

Tanya [11:26 PM]
"делиться своим решением можно в личку, либо после первого занятия (04.10). Те после разбора
иначе соблазн не далать самому а подглядеть "


Dima [Yesterday at 11:27 PM]
я думаю все большие дяди и тети, как бы не ради игры пошли на стажировку , а чтоб получить какой то опыт.


2 replies
Tanya [11 hours ago]
видимо не все :wink:


Victor_Ch [8 hours ago]
да и в общем смысла нет рассказывать что да как сделал.
вот когда эксепшены полетели, тогда интересно в коде поковыряться ))) ну или вопросы, непонятки, сомнения обсудить


Victor_Ch [Today at 12:14 AM]
*Подсказка как отвечать в Slack:*
```наводим на сообщение
начинаем новый thread
следим за интересующими топиками в All thread
не флудим, порядка больше.```
(edited)


1 reply
Vladimir Gorbatenko [45 minutes ago]
Вот кто так делает? Я уже пошел искать где в настройках слака есть режим "Русский язык" ))


Victor_Ch [3 days ago]
Зачем? English наше всё!


Andrey Tolkachev [3 days ago]
согласен, пора отвыкать от русского


Nikolaj [Today at 12:10 PM]
Я изменил  "private final boolean exceed" на "public static boolean exceed",  и добавил гетер который возвращает его значение. Можно ли так делать?
Я руководствуюсь тем что логика класса от этого не меняется, и гетер как возвращал нужное значение так и возвращает.


4 replies
Roman Baranov [5 hours ago]
а зачем? какую цель преследовали? и логика поменяется. раньше поле принадлежало только объекту, а теперь целому классу.


Aleksey Romantsov [4 hours ago]
У *каждого* объекта был свой признак, а теперь есть только *один* общий признак на весь класс


Gekov Iliya [4 hours ago]
Не очень понимаю как логика не поменяется, если у каждого объекта этого класса данное поле меняется в зависимости от даты, то есть это поле не может иметь одинаковое значение для всех объектов


Also sent to the channel
Nikolaj [4 hours ago]
Хорошо, спасибо за ответы, я ошибался.  Подумал что этот класс используется только в рамках одного дня. И тогда поле exceed будет одинаковое для всех объектов. Неправильно понял задание)


Marat [7:10 PM]
Привет всем.

nick [10:30 PM]
привет

Ivan [5:53 AM]
Привет всем, у меня вот такой вопрос.
У нас есть UserMeal, зачем нам UserMealWithExeed? почему бы не добавить поле bool exeed в UserMeal и им оперировать, зачем вот этот отдельный класс с добавленным одним полем?

koderman [6:12 AM]
Хай, еще думаю можно UserMealWithExeed унаследовать от UserMeal

Marat [6:20 AM]
Подскажите, Для каждого ДЗ делать ветку ?
А патч накатывать на ветку мастер только?

Ivan [6:22 AM]
да

Anton Potemkin [6:48 AM]
@Ivan @koderman по этому поводу написано в  Замечаниях к HW0
2: Наследовать UserMealWithExceed от UserMeal я не буду, т.к. это разные сущности: Transfer Object и Entity. Мы будет их проходить на 2м уроке.

Marat [6:49 AM]
Зачем Поменять фонт по умолчанию (DejaVu)  ?
Со стандартными шрифтами проект не будет работать что-ли?

Anton Potemkin [6:56 AM]
@Marat Я думаю что будет, я использую Fira Code и мне нравится)

nick [11:12 AM]
@Marat Ветку нужно делать для каждого дз, а патчи накатываются только на мастер, и больше никаких изменений в мастере делать не нужно
Фонт не играет роли, но так ты больше познакомишься с настройками Idea.

Marat [11:14 AM]
Понятно, спасибо.
А как проверять ДЗ? Или только после разбора ДЗ на следующем уроке?

nick [11:29 AM]
если у тебя подписка с проверкой кода - то Григорий, после проверки, скажет тебе свои замечания, конкретно по твоей реализации, и даст советы лично тебе. Все остальные будут смотреть разбор дз (как надо и как не надо делать) на следующем уроке (в том числе и Optional)